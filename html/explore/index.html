{% load i18n %}
{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <base href="{{HTTP_HOST}}">

  <title>The Observatory | {{title}} ({% if year_start %}{{year_start}} - {{year_end}}{% else %}{{year}}{% endif %})</title>
  <meta name="description" content="Networks in Macro Economics">
  <meta name="author" content="Alexander Simoes">
  <!-- Necessary for google to crawl the site, since it is purely ajax based.
        When the crawler reaches the page it will request the current URL plus
        the additional URL query parameter _escaped_fragment_= -->
  <meta name="fragment" content="!">
  
  <link rel="shortcut icon" type="image/x-icon" href="media/img/favicon.ico">
    <!-- Load non-standard fonts -->
  <link href='http://fonts.googleapis.com/css?family=Open+Sans+Condensed:300' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow' rel='stylesheet' type='text/css' />
  <link href='http://fonts.googleapis.com/css?family=Cardo' rel='stylesheet' type='text/css' />
  
  <link rel="stylesheet" href="media/js/libs/bootstrap/css/bootstrap.css"/>
  <link rel="stylesheet" href="media/css/normalize.css">
  <link rel="stylesheet" href="media/css/style.css">
  <link rel="stylesheet" href="media/js/libs/chosen/chosen.css" />
  <link rel="stylesheet" href="media/js/libs/tipsy/tipsy.css" />
  <link rel="stylesheet" href="media/js/libs/vizwiz/src/utils.slider.css" />

<link rel="stylesheet" href="media/css/countries.css" />

  <link rel="stylesheet" href="media/js/libs/jquery-ui/jquery-ui.css" type="text/css" media="all" />
  <!-- VizWiz -->
  <link href="media/js/libs/vizwiz/src/vizwhiz.d3.css" rel="stylesheet" type="text/css"> 
  
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>
<body class="app">
  {% if alert %}
  <div class="alert">
    <div>
      {% if alert.title %}
      <h4>{{alert.title}}</h4>
      {% endif %}
      {% if alert.text %}{{alert.text|safe}}{% endif %}
    </div>
  </div>
  {% endif %}
  {% if warning %}
  <div class="warning">
    <div>
      {% if warning.title %}
      <h4>{{warning.title}}</h4>
      {% endif %}
      {% if warning.text %}{{warning.text|safe}}{% endif %}
    </div>
  </div>
  {% endif %}
  <div id="container">
    <header>
     <div class="logo" style="background-color: #fafafa; width:200px; height:66px;">
        <a href="" title="Home" style="text-decoration: none;">
        <h1 style="background: url(media/img/all/logo_rainbow.png) repeat-x 100% 100%;">&nbsp;&nbsp;The Atlas Of</h1>
        <h2 style="font-size:14px; margin-top:-3px; text-align:center; letter-spacing:1px; color:gray; text-transform:uppercase; text-decoration:none;">&nbsp;Economic Complexity</h2></a> 
      </div>  
      <nav>
        <ul>
          <li><a href="explore">Explore</a></li>
          <!-- <li><a href="/country/usa/">Profiles</a></li> -->
          <li><a href="stories">Stories</a></li>
          <li><a href="rankings">Rankings</a></li>
          <li><a href="book">Book</a></li>
          <li><a href="about">About</a></li>
        </ul>
      </nav> 
     
      <br class="clear">
    </header>
    
    <div id="main" role="main">
      
      <div class="app_title" id="icons" style="width:230px; height:60px; margin-left:10px;">
        
        <!-- Left icon 
        {% if product_list and not country1_list %}
        <img class="img left community" src="/media/img/icons/community_{{ product.community.id }}.png" alt="product.name_en">
        {% endif %}
        {% if country1_list %}
        <img class="img left" src="/media/img/icons/flag_{{ country1.name_3char|lower }}.png" alt="{{country1.name}}">
        {% endif %}
        
        <!-- year(s)
        {% if year_start %}
        <h2 class="left">{{year_start}}<br />{{year_end}}</h2>
        {% else %}
        <h2 class="left small">{{year}}</h2>
        {% endif %}
        
        <!-- Right icon
        {% if country2_list %}
        <img class="img right" src="/media/img/icons/flag_{{ country2.name_3char|lower }}.png" alt="{{country2.name}}">
        {% endif %}
        {% if country1_list and product_list %}
        <img class="img right community" src="/media/img/icons/community_{{ product.community.id }}.png" alt="{{product.name_en}}">
        {% endif %}
        -->

      <script>
      // http://127.0.0.1:8000/explore/tree_map/export/usa/all/show/2011/

      function update_viz(viz) {
      
        var url = "explore/";
        var current_viz = (typeof viz != "undefined" )  ? viz : $("#viz_apps").find(".active").attr("value");
        current_viz = (typeof current_viz == "undefined" || current_viz == "") ? "tree_map" : current_viz; 

        var current_year1 = $("#year1").find(":selected").val();


        // COUNTRIES
        if($(".main-countries-products").find(".active").index()==0) { 

          var current_flow = $("#trade_flow").find(":selected").val();
          var current_country1 = $("#country1").find(":selected").val();
          current_country1 = (typeof current_country1 == "undefined" || current_country1 == "") ? "all" : current_country1; 


          var current_country2 = $("#country-trade-partner").find(":selected").attr("value");
          current_country2 = (typeof current_country2 == "undefined" || current_country2 == "") ? "all" : current_country2; 


          var current_product = $("#country_product_select").find(":selected").val();
          current_product = (typeof current_product == "undefined" || current_product == "") ? "all" : current_product; 

          var current_year2 = $("#year2").find(":selected").val();
          current_year2 = (typeof current_year2 == "undefined" || current_year2 == "") ? "" : "."+current_year2+".1"; 

          if(current_country2!="all")
            current_viz = "tree_map";

          if(current_year2!="")
            current_viz = "stacked";

          // http://atlas.cid.harvard.edu/beta/explore/tree_map/export/usa/all/show/2011/
          // http://atlas.cid.harvard.edu/beta/explore/tree_map/export/usa/show/2709/2011/

          // Where does United States export Crude Petroleum to?
          // http://atlas.cid.harvard.edu/beta/explore/tree_map/export/usa/show/2709/2011/
          if($(".tab-trade-partner-product").find(".active").index()==0) {

            // if a country is not selected..
            if(current_country1=="all") {

              url += current_viz+"/"+current_flow+"/show/"+current_country1+"/"+current_product+"/"+current_year1+"/";         

            // What did United States export in 2011?
            // http://127.0.0.1:8000/explore/tree_map/export/usa/all/show/2011/
            } else if(current_product=="all") {

              url += current_viz+"/"+current_flow+"/"+current_country1+"/all/show/"+current_year1+"/";         

            } else {

              url += current_viz+"/"+current_flow+"/"+current_country1+"/show/"+current_product+"/"+current_year1+"/";
            

            }

            // http://atlas.cid.harvard.edu/beta/explore/tree_map/import/usa/chn/show/2011/

          // http://atlas.cid.harvard.edu/beta/explore/tree_map/export/usa/show/2709/2011/
          } else if($(".tab-trade-partner-product").find(".active").index()==1) {
            url += current_viz+"/"+current_flow+"/"+current_country1+"/"+current_country2+"/show/"+current_year1+current_year2+"/"

          } else {

            console.log("error");
          }


          if(current_country1=="all" && current_product=="all") {
            alert("Please, select at least one country or one product")
          } else {

            window.location.assign(url);            
          }


        // http://atlas.cid.harvard.edu/beta/explore/tree_map/export/show/all/0101/2011/
        } else if($(".main-countries-products").find(".active").index()==1) {

          var current_product = $("#product").find(":selected").val();
          var current_product_trade_flow = $("#product-trade-flow").find(":selected").val();

          var current_product_country = $("#products_country1_select").find(":selected").val();
          current_product_country = (typeof current_product_country == "undefined" || current_product_country == "") ? "all" : current_product_country; 

          console.log("products", current_product, current_product_trade_flow, current_product_country)

          url += current_viz+"/"+current_product_trade_flow+"/show/"+current_product_country+"/"+current_product+"/"+current_year1+"/";
          window.location.assign(url);


        } else {
          console.log("ERROR IN SELECTEC COUNTRIES/PRODUCTS TAB");

        }

      }

      </script>
     

      <ul class="nav nav-tabs main-countries-products" id="myTab">
        <li class="active"><a href="#tab-countries"><span class="glyphicon glyphicon-globe"></span>  <span style="font-size:18px;">World Data</span></a></li>
       <!-- <li><a href="#tab-products"><span class="glyphicon glyphicon-barcode" style="font-size:14px; color:gray"></span> <span  style="font-size:18px;">Products</span></a></li>-->
      </ul>

      </div>

      <div class="app_title" id="title">
        <h2 style="margin-left:10px; width:700px;" id="text_title">{% if title %}{{title}}{% else %}&nbsp;{% endif %}</h2>
      </div>
      
      <br style="clear:both">

      <!-- The left pane -->
      <div id="app_pane" style="width:230px; height:550px">
        <div class="tab-content" style="height:400px">

          <!-- Country selection -->
          <div class="tab-pane active" id="tab-countries"> <!-- {% if not product_list %}active{% endif %} -->
            <span style="margin:10px 0px; font-weight:bold;">Select a Country:</span>
            <div id="country1" width="120px" style="margin-left: 0px;" onmouseover="$('.show-partner').css('visibility', 'visible');"  onmouseout="$('.show-partner').css('visibility', 'hidden');">

              <button type="button" onclick="update_viz()" class="glyphicon glyphicon-refresh show-partner" style="float:right; margin-right:10px; width:25px; height:20px; font-size:8px; visibility:hidden;"></button>

                  <select data-placeholder="All Countries" id="country1_select" class="chosen-select-deselect" tabindex="-1" style="display: none;">

                <option value=""></option>
                  {% if country1_list %}

                    {% for c in country1_list %}
                    {% if c.id == country1.id %}
                    <option value="{{c.name_3char|lower}}" selected="selected">{{ c.name }}</option>
                    {% else %}
                    <option value="{{c.name_3char|lower}}">{{ c.name }}</option>
                    {% endif %}
                    {% endfor %}

                  {% else %}

                    {% include "explore/list_countries.html" %}

                  {% endif %}
              </select>
            </div>

          <ul class="nav nav-tabs main-countries-products" id="myTab" style="width:210px; margin-top:20px">
            <li {% if app_name != "product_space" and app_name != "pie_scatter" %}class="active"{% endif %}><a href="#tab-trade"> <span class="glyphicon glyphicon-resize-horizontal"></span> <span style="font-size:14px;">Trade Flow</span></a></li>
            <li {% if app_name == "product_space" or app_name == "pie_scatter" %}class="active"{% endif %}><a href="#tab-diversification"><span style="font-size:14px; color:gray;">Diversification</span></a></li>
          </ul>

        <!-- TRADE / DIVERSIFICATION -->
        <div class="tab-content"  style="height:50px; border: solid 1px #e6e6e6; border-top: 0px; padding-top:10px; width:210px; height:290px;">

          <!-- Country selection -->
          <div class="tab-pane {% if app_name != "product_space" and app_name != "pie_scatter" %}active{% endif %}" id="tab-trade">

           <!-- Trade Flow selection -->
          <b style="margin:10px 0px; margin-left:10px">Type of <span class="definition">Flow</span>:</b>
          <div class="dropdown_container" id="trade_flow" style="margin-left: 8px;" onmouseover="$('.show-trade-flow').css('visibility', 'visible');"  onmouseout="$('.show-trade-flow').css('visibility', 'hidden');">
            

            <button type="button" onclick="update_viz()" class="glyphicon glyphicon-refresh show-trade-flow" style="float:right; margin-right:10px; width:25px; height:20px; font-size:8px; visibility:hidden;"></button>

            <select data-url_pos="5">
              {% for tf in trade_flow_list %}
              {% if tf.0 == trade_flow %}
              <option value="{{tf.0}}" selected="selected">{{ tf.1 }}</option>
              {% else %}
              <option value="{{tf.0}}">{{ tf.1 }}</option>
              {% endif %}
              {% endfor %}
            </select>
          </div>
       
          <ul class="nav nav-tabs tab-trade-partner-product" id="myTab" style="margin-top: 20px; margin-left:10px; width:190px;">
            <li{% if product_list %} class="active"{% endif %}><a href="#show-country-product"><span class="glyphicon glyphicon-barcode" style="font-size:14px; color:gray;"></span>  <span style="font-size:14px; color:gray;">Product</span></a></li>
            <li{% if not product_list %} class="active"{% endif %}><a href="#show-country-partner"><span class="glyphicon glyphicon-globe" style="font-size:14px; color:gray;"></span> <span style="font-size:14px;">Partner</span></a></li>
          </ul>

          <!-- Tab Trade Partner/Product -->
          <div class="tab-content" style="height:50px; border: solid 1px #e6e6e6; border-top: 0px; padding-top:10px; width:190px; margin-left:10px; height:60px">
          
            <div class="tab-pane {% if product_list %} active{% endif %}" id="show-country-product">

              <div id="country-product" width="120px" style="margin-left:10px;"  onmouseover="$('.show-country-product').css('visibility', 'visible');"  onmouseout="$('.show-country-product').css('visibility', 'hidden');">
          
                <button type="button" onclick="update_viz();" class="glyphicon glyphicon-refresh show-country-product" style="float:right; margin-right:10px; width:25px; height:20px; font-size:8px; visibility:hidden;"></button>

                <select data-placeholder="All Products" id="country_product_select" class="chosen-select-deselect" tabindex="-1" style="display: none;">
                 <option value=""></option>
                 {{ product_list }}
                  {% for p in product_list %}
                  {% if p.id == product.id %}
                  <option value="{{p.code}}" selected="selected">{{ p.name }}</option>
                  {% else %}
                  <option value="{{p.code}}">{{ p.name }}</option>
                  {% endif %}
                  {% endfor %}
                  {% include "explore/list_products.html" %}
                </select>

              </div>
            </div>

            <div class="tab-pane {% if not product_list %} active{% endif %}" id="show-country-partner">

              <div id="country-trade-partner" style="margin-left: 10px;" onmouseover="$('.show-trade-partner').css('visibility', 'visible');" onmouseout="$('.show-trade-partner').css('visibility', 'hidden');">

                 <button type="button" onclick="update_viz();" class="glyphicon glyphicon-refresh show-trade-partner" style="float:right; margin-right:10px; width:25px; height:20px; font-size:8px; visibility:hidden;"></button>

                  <select data-placeholder="All Countries" id="country_trade_partner_select" class="chosen-select-deselect" tabindex="-1" style="display: none;">
                    <option value=""></option>
                    {% for c in country1_list %}
                    {% if c.id == country2.id %}
                    <option value="{{c.name_3char|lower}}" selected>{{ c.name }}</option>
                    {% else %}
                    <option value="{{c.name_3char|lower}}">{{ c.name }}</option>
                    {% endif %}
                    {% endfor %}
                  </select>
              </div>
            </div>

          </div>

          <div style="font-weight:bold; margin-top:10px; margin-left:10px">Visualization:</div>

          <div class="btn-group" id="viz_apps" data-toggle="buttons" style="margin-top:10px; margin-left:10px">
            <label value="tree_map" id="treemap_viz" name="viz_apps" class="btn btn-default {% if app_name == 'tree_map' %}active{% endif %}" onclick="update_viz('tree_map');" data-container="body" data-toggle="popover" data-placement="top" title="Treemap" data-content="<img src='media/img/home/teaser_tree_map.png' style='width:100px; float:left; padding:10px'/>A <b>Treemap</b> is a method for displaying hierarchical data by using nested rectangles. Treemaps display hierarchical (tree-structured) data as a set of nested rectangles. Each branch of the tree is given a rectangle, which is then tiled with smaller rectangles representing sub-branches. A leaf node's rectangle has an area proportional to a specified dimension on the data. Often the leaf nodes are colored to show a separate dimension of the data." {% if year_interval_list %}disabled{%endif%}>
              <input type="radio" id="option1" style="background:url(media/img/home/teaser_tree_map.png) no-repeat;"> <img src="media/img/home/teaser_tree_map.png" style="width:38px;"/>
            </label>
            <label value="map" id="map_viz" class="btn btn-default {% if app_name == 'map' %}active{% endif %}" onclick="update_viz('map');" data-container="body" data-toggle="popover" data-placement="top" title="Map" data-content="<img src='media/img/home/teaser_map.png' style='width:100px; float:left; padding:10px'/>A <b>map</b> is a visual representation of an area â€“ a symbolic depiction highlighting relationships between elements of that space such as objects, regions, and themes. Many maps are static two-dimensional, geometrically accurate (or approximately accurate) representations of three-dimensional space, while others are dynamic or interactive, even three-dimensional. Although most commonly used to depict geography, maps may represent any space, real or imagined, without regard to context or scale; e.g. brain mapping, DNA mapping and extraterrestrial mapping." {% if year_interval_list %}disabled{%endif%}>
              <input type="radio" name="viz_apps" id="option2"> <img src="media/img/home/teaser_map.png" style="width:38px;"/>
            </label>
            <label value="stacked" class="btn btn-default {% if year_interval_list %}active{%endif%}" onclick="update_viz();" {% if not year_interval_list %}disabled{%endif%}>
              <input type="radio" name="viz_apps" id="option3" > <img src="media/img/home/teaser_stacked.png" style="width:38px;"/>
            </label>
          </div>

          </div>

          <!-- Diversification TAB -->

           <div class="tab-pane {% if app_name == "product_space" or app_name == "pie_scatter" %}active{% endif %}" id="tab-diversification">
            <div class="btn-toolbar" style="margin-left:10px;">
              <a href="explore/product_space/export/usa/all/show/2011/"><div class="btn-group">
                <label type="button" class="btn btn-default {% if app_name == "product_space" %}active{% endif %}" style="width:190px; text-align:left">
                  <img src="media/img/home/pie_new.png" style="width:50px;"/> <b>The Product Space</b><br> A map that visualizes the products<br> a country currently produces, and<br> the feasibility of and trajectory for<br> product diversification.
                </label></div></a>
              <br><br>
              <a href="explore/pie_scatter/export/usa/all/show/2011/">
              <div class="btn-group"><label type="button" class="btn btn-default {% if app_name == "pie_scatter" %}active{% endif %}" style="width:195px; text-align:left; margin-left:-5px; margin-top:10px"><img src="media/img/home/teaser_product_space.png" style="width:50px;"/> <b>Products Feasibility</b><br> Shows how many different types of<br> products a country is able to make. </label></div>
              </a>
            </div>

          </div>
        </div>
      </div>
    <!-- Product Tab -->
    <div class="tab-pane " id="tab-products">
      <b style="margin:10px 0px">Select a Product:</b>
      <div class="dropdown_container" id="product" width="120px" style="margin-left: 10px;" onmouseover="$('.show-product').css('visibility', 'visible');"  onmouseout="$('.show-product').css('visibility', 'hidden');">

        <button type="button" onclick="update_viz()" class="glyphicon glyphicon-refresh show-product" style="float:right; margin-right:10px; width:25px; height:20px; font-size:8px; visibility:hidden;"></button>

        <!-- If no list from server, then load local one -->

        {% if product_list %}
        <select>
         <option value=""></option>
         {{ product_list }}
          {% for p in product_list %}
          {% if p.id == product.id %}
          <option value="{{p.code}}" selected="selected">{{ p.name }}</option>
          {% else %}
          <option value="{{p.code}}">{{ p.name }}</option>
          {% endif %}
          {% endfor %}

          {% include "explore/list_products.html" %}
        </select>

        {% else %}

        <select data-url_pos="0">
          {% include "explore/list_products.html" %}
        </select>

        {% endif %}

      </div>

      <!-- Product Trade Flow -->
      <div style="margin-left: 15p; margin-top:20px; font-weight:bold;">Select a <span class="definition">Trade Flow:</div>

      <div class="dropdown_container" id="product-trade-flow" width="120px" style="margin-left: 10px;" onmouseover="$('.show-trade-flow').css('visibility', 'visible');"  onmouseout="$('.show-trade-flow').css('visibility', 'hidden');">
            
      <button type="button" onclick="update_viz()" class="glyphicon glyphicon-refresh show-trade-flow" style="float:right; margin-right:10px; width:25px; height:20px; font-size:8px; visibility:hidden;"></button>

        <select data-url_pos="5">
          {% for tf in trade_flow_list %}
          {% if tf.0 == trade_flow %}
          <option value="{{tf.0}}" selected="selected">{{ tf.1 }}</option>
          {% else %}
          <option value="{{tf.0}}">{{ tf.1 }}</option>
          {% endif %}
          {% endfor %}
        </select>

      </div>


      <ul class="nav nav-tabs tab-trade-partner-product" id="myTab" style="margin-top: 20px">
        <li class="active"><a href="#show-country-partner"><span style="font-size:16px;" class="definition">Country</span></a></li>
      </ul>

          <!-- Tab Trade Partner/Product -->
          <div class="tab-content" style="height:50px; border: solid 1px #e6e6e6; border-top: 0px; padding-top:10px">
          <!--
            <div class="tab-pane {% if not product_list %} active{% endif %}" id="show-country-partner">

              <div id="country-trade-partner" width="120px" style="margin-left: 10px;" onmouseover="$('.show-trade-partner').css('visibility', 'visible');" onmouseout="$('.show-trade-partner').css('visibility', 'hidden');">

                 <button type="button" onclick="update_viz();" class="glyphicon glyphicon-refresh show-trade-partner" style="float:right; margin-right:10px; width:25px; height:20px; font-size:8px; visibility:hidden;"></button>

                  <select data-placeholder="All Countries" id="select-country-trade-partner" class="chosen-select-deselect" tabindex="-1" style="display: none;">
                    <option value=""></option>
                    {% for c in country1_list %}
                    {% if c.id == country2.id %}
                    <option value="{{c.name_3char|lower}}" selected>{{ c.name }}</option>
                    {% else %}
                    <option value="{{c.name_3char|lower}}">{{ c.name }}</option>
                    {% endif %}
                    {% endfor %}
                  </select>
              </div>
            </div>
  -->

            <div class="tab-pane active" id="show-country-product">

              <div id="country-product" width="120px" style="margin-left:10px;"  onmouseover="$('.show-country-product').css('visibility', 'visible');"  onmouseout="$('.show-country-product').css('visibility', 'hidden');">
          
                <button type="button" onclick="update_viz();" class="glyphicon glyphicon-refresh show-country-product" style="float:right; margin-right:10px; width:25px; height:20px; font-size:8px; visibility:hidden;"></button>



                <select data-placeholder="All Countries" class="chosen-select-deselect" tabindex="-1" style="display: none;" id="products_country1_select">
 <option value=""></option>
                  {% if country1_list %}

                    {% for c in country1_list %}
                    {% if c.id == country1.id %}
                    <option value="{{c.name_3char|lower}}" selected="selected">{{ c.name }}</option>
                    {% else %}
                    <option value="{{c.name_3char|lower}}">{{ c.name }}</option>
                    {% endif %}
                    {% endfor %}

                  {% else %}

                    {% include "explore/list_countries.html" %}

                  {% endif %}

                </select>


              </div>
            </div>
          </div>



    </div> <!-- End Product Tab -->
  


  <!-- END -->


  </div>



  <!-- Year tab -->
  <div class="tab-content">
    <ul class="nav nav-tabs" id="myTab">
      <li class="active"><a href="#country-year"><span class="glyphicon glyphicon-calendar"></span> <span style="font-size:16px;">Time Period</span></a></li>
     <!-- <li><a href="#country-over-time"><span class="glyphicon glyphicon-calendar"></span> </span> <span  style="font-size:16px">Over Time</span></a></li>-->
    </ul>

    <div class="tab-content" style="height:50px; border: solid 1px #e6e6e6; border-top: 0px; padding-top:10px;"  onmouseover="$('.over-time').css('visibility', 'visible');"  onmouseout="$('.over-time').css('visibility', 'hidden');">

      <div class="tab-pane active" id="country-year">

        <button type="button" onclick="update_viz();" class="glyphicon glyphicon-refresh over-time" style="float:right; margin-right:10px; width:25px; height:20px; font-size:8px; visibility:hidden;"></button>


        <div class="dropdown_container " id="year1" style="float:left; margin-left:10px;">
           <select data-url_pos="5" id="year1_select" style="width:80px"  data-placeholder="All Countries">
            {% for y in year1_list %}
            {% if y == year or y == year_start %}
            <option value="{{y}}" selected="selected">{{ y }}</option>
            {% else %}
            <option value="{{y}}">{{ y }}</option>
            {% endif %}
            {% endfor %}
          </select>
        </div>

        <div id="year2" style="float:left; margin-left:10px;">
          <select data-placeholder="End" class="chosen-select-deselect" id="year2_select" tabindex="-1" style="display: none;">
            <option value=""></option>
            {% for y in year1_list %}
            {% if y == year_end %}
            <option value="{{y}}" selected="selected">{{ y }}</option>
            {% else %}
            <option value="{{y}}">{{ y }}</option>
            {% endif %}
            {% endfor %}
          </select>
        </div>
      </div>
      <div class="tab-pane" id="country-over-time">

        <div class="product_class" style="float:left; margin-left:10px;">
           <select data-url_pos="5" id="year1_select" style="width:80px">
            {% for y in year1_list %}
            {% if y == year or y == year_start %}
            <option value="{{y}}" selected="selected">{{ y }}</option>
            {% else %}
            <option value="{{y}}">{{ y }}</option>
            {% endif %}
            {% endfor %}
          </select>
        </div>


        <div class="product_class" style="float:left; margin-left:10px;">
           <select data-url_pos="5" id="year1_select" style="width:80px">
            {% for y in year1_list %}
            {% if y == year or y == year_start %}
            <option value="{{y}}" selected="selected">{{ y }}</option>
            {% else %}
            <option value="{{y}}">{{ y }}</option>
            {% endif %}
            {% endfor %}
          </select>
        </div>


      </div>
    </div>
</div>



<!--
<h4 style="border-bottom: solid 1px #999; font-family:'PT Sans Narrow',Helvetica,Arial; font-size:95%; font-weight:500; margin: 0; padding: 0 0 2px 0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Type of representation</h4>
-->



<!--
<button type="button" id="show-partner" class="glyphicon glyphicon-refresh" style="float:left; margin: 0px 10px"></button>

       <button id="build" style="float:left; margin-bottom:20px">{% trans "Build Visualization" %} &raquo;</button>
    -->


<!--
      <h3 class="ui-accordion-header ui-helper-reset ui-state-default ui-corner-all ui-state-focus" role="tab" aria-expanded="false" aria-selected="false" tabindex="0"><span class="ui-icon ui-icon-triangle-1-s"></span><a href="#">Parameters</a></h3>

    <div class="">
        <div class="control_container" id="download">
          <h3>{% trans "Download" %}</h3>
          <a class="pdf" href="#"><img src="/media/img/app/download.png" /> PDF</a>
          <a class="svg" href="#"><img src="/media/img/app/download.png" /> SVG</a>
          <a class="png" href="#"><img src="/media/img/app/download.png" /> PNG</a>
          <a class="csv" href="#"><img src="/media/img/app/download.png" /> CSV</a>
        </div>
        <div class="control_container" id="view_as_text">
          <a class="text" href="#"><img src="/media/img/app/text.png" /> <span>{% trans "View as text" %}</span></a>
        </div>
        <div class="control_container">
          <h3>{% trans "Embed" %}</h3>
          <input type="text" class="embed_code" value='&lt;iframe width="560" height="315" src="http://atlas.media.mit.edu/embed/tree_map/import/usa/show/all/2011/" frameborder="0" &gt;&lt;/iframe&gt;'></input>
        </div>
        

        </div>

-->

        <!--
          <div>
            <h3><a href="#">Tree Maps</a></h3>
            <div>
              <h4>{% trans "Country" %}</h4>
              <ul>
                <li><a class="casy" href="/explore/tree_map/export/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/all/show/2011/" >{% trans "Exports" %}</a></li>
                <li><a class="casy" href="/explore/tree_map/import/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/all/show/2011/">{% trans "Imports" %}</a></li>
                <li><a class="casy" href="/explore/tree_map/net_export/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/all/show/2011/">{% trans "Net Exports" %}</a></li>
                <li><a class="casy" href="/explore/tree_map/net_import/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/all/show/2011/">{% trans "Net Imports" %}</a></li>
              </ul>
              <h4>{% trans "Country (show trade partners)" %}</h4>
              <ul>
                <li><a class="csay" href="/explore/tree_map/export/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/show/all/2011/">{% trans "Exports" %}</a></li>
                <li><a class="csay" href="/explore/tree_map/import/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/show/all/2011/">{% trans "Imports" %}</a></li>
              </ul>
              <h4>{% trans "Products" %}</h4>
              <ul>
                <li><a class="sapy" href="/explore/tree_map/export/show/all/{% if item_type == "countries" %}{{product_code}}{%else%}{% if product_classification == "sitc4" %}3330{% else %}2709{% endif %}{% endif %}/2011/">{% trans "Exports To Destination" %}</a></li>
                <li><a class="sapy" href="/explore/tree_map/import/show/all/{% if item_type == "countries" %}{{product_code}}{%else%}{% if product_classification == "sitc4" %}3330{% else %}2709{% endif %}{% endif %}/2011/">{% trans "Imports From Origin" %}</a></li>
              </ul>
              <h4>{% trans "Bilateral" %}</h4>
              <ul>
                <li><a class="ccsy" href="/explore/tree_map/export/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/{% if country_code == "chn"%}usa{%else %}chn{%endif%}/show/2011/">{% trans "Exports To Destination" %}</a></li>
                <li><a class="ccsy" href="/explore/tree_map/import/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/{% if country_code == "chn"%}usa{%else %}chn{%endif%}/show/2011/">{% trans "Imports From Origin" %}</a></li>
                <li><a class="cspy" href="/explore/tree_map/export/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/show/{% if item_type == "countries" %}{{product_code}}{%else%}{% if product_classification == "sitc4" %}3330{% else %}2709{% endif %}{% endif %}/2011/">{% trans "Exports by Product" %}</a></li>
                <li><a class="cspy" href="/explore/tree_map/import/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/show/{% if item_type == "countries" %}{{product_code}}{%else%}{% if product_classification == "sitc4" %}3330{% else %}2709{% endif %}{% endif %}/2011/">{% trans "Imports by Product" %}</a></li>
              </ul>
            </div>
          </div>
          <div>
            <h3><a href="#">Stacked Area Charts</a></h3>
            <div>
              <h4>{% trans "Country" %}</h4>
              <ul>
                <li><a class="casy" href="/explore/stacked/export/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/all/show/{%if product_classification == "sitc4"%}1965.2005.5{% else %}1995.2011.2{% endif %}/">{% trans "Exports" %}</a></li>
                <li><a class="casy" href="/explore/stacked/import/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/all/show/{%if product_classification == "sitc4"%}1965.2005.5{% else %}1995.2011.2{% endif %}/">{% trans "Imports" %}</a></li>
                <li><a class="casy" href="/explore/stacked/net_export/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/all/show/{%if product_classification == "sitc4"%}1965.2005.5{% else %}1995.2011.2{% endif %}/">{% trans "Net Exports" %}</a></li>
                <li><a class="casy" href="/explore/stacked/net_import/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/all/show/{%if product_classification == "sitc4"%}1965.2005.5{% else %}1995.2011.2{% endif %}/">{% trans "Net Imports" %}</a></li>
              </ul>
              <h4>{% trans "Country (show trade partners)" %}</h4>
              <ul>
                <li><a class="csay" href="/explore/stacked/export/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/show/all/{%if product_classification == "sitc4"%}1965.2005.5{% else %}1995.2011.2{% endif %}/">{% trans "Exports" %}</a></li>
                <li><a class="csay" href="/explore/stacked/import/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/show/all/{%if product_classification == "sitc4"%}1965.2005.5{% else %}1995.2011.2{% endif %}/">{% trans "Imports" %}</a></li>
              </ul>
              <h4>{% trans "Products" %}</h4>
              <ul>
                <li><a class="sapy" href="/explore/stacked/export/show/all/{% if item_type == "countries" %}{{product_code}}{%else%}{% if product_classification == "sitc4" %}3330{% else %}2709{% endif %}{% endif %}/{%if product_classification == "sitc4"%}1965.2005.5{% else %}1995.2011.2{% endif %}/">{% trans "Exports To Destination" %}</a></li>
                <li><a class="sapy" href="/explore/stacked/import/show/all/{% if item_type == "countries" %}{{product_code}}{%else%}{% if product_classification == "sitc4" %}3330{% else %}2709{% endif %}{% endif %}/{%if product_classification == "sitc4"%}1965.2005.5{% else %}1995.2011.2{% endif %}/">{% trans "Imports From Origin" %}</a></li>
              </ul>
              <h4>{% trans "Bilateral" %}</h4>
              <ul>
                <li><a class="ccsy" href="/explore/stacked/export/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/{% if country_code == "chn"%}usa{%else %}chn{%endif%}/show/{%if product_classification == "sitc4"%}1965.2005.5{% else %}1995.2011.2{% endif %}/">{% trans "Exports To Destination" %}</a></li>
                <li><a class="ccsy" href="/explore/stacked/import/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/{% if country_code == "chn"%}usa{%else %}chn{%endif%}/show/{%if product_classification == "sitc4"%}1965.2005.5{% else %}1995.2011.2{% endif %}/">{% trans "Imports From Origin" %}</a></li>
                <li><a class="cspy" href="/explore/stacked/export/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/show/{% if item_type == "countries" %}{{product_code}}{%else%}{% if product_classification == "sitc4" %}3330{% else %}2709{% endif %}{% endif %}/{%if product_classification == "sitc4"%}1965.2005.5{% else %}1995.2011.2{% endif %}/">{% trans "Exports by Product" %}</a></li>
                <li><a class="cspy" href="/explore/stacked/import/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/show/{% if item_type == "countries" %}{{product_code}}{%else%}{% if product_classification == "sitc4" %}3330{% else %}2709{% endif %}{% endif %}/{%if product_classification == "sitc4"%}1965.2005.5{% else %}1995.2011.2{% endif %}/">{% trans "Imports by Product" %}</a></li>
              </ul>
            </div>
          </div>
          <div>
            <h3><a href="#">Product Space</a></h3>
            <ul>
              <li><a class="casy" href="/explore/product_space/export/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/all/show/2011/">Product Space of {% trans "Exports" %}</a></li>
              <li><a class="disabled" href="#">Density Product Space</a></li>
            </ul>
          </div>
          <div>
            <h3><a href="#">Diversification Options</a></h3>
            <ul>
              <li><a class="casy" href="/explore/pie_scatter/export/{% if country_code != None%}{{country_code}}{%else %}usa{% endif %}/all/show/2011/">Pie Scatter Chart</a></li>
              <li><a class="disabled" href="#">Density Bars</a></li>
              <li><a class="disabled" href="#">Stepping Stone</a></li>
            </ul>
          </div>
          <div>
            <h3><a href="#">Maps</a></h3>
            <ul>
              <li><a class="sapy" href="/explore/map/export/show/all/{%if product_classification == "sitc4"%}3330{% else %}2709{% endif %}/2011/">Exports</a></li>
              <li><a class="sapy" href="/explore/map/import/show/all/{%if product_classification == "sitc4"%}3330{% else %}2709{% endif %}/2011/">Imports</a></li>
              <li><a class="sapy" href="/explore/map/net_export/show/all/{%if product_classification == "sitc4"%}3330{% else %}2709{% endif %}/2011/">Net exports</a></li>
              <li><a class="sapy" href="/explore/map/net_import/show/all/{%if product_classification == "sitc4"%}3330{% else %}2709{% endif %}/2011/">Net imports</a></li>
            </ul>
          </div>
        </div>-->
      </div> <!-- END app selection pane -->
      
      <!-- the Visualization -->
      <div id="content" style="width: 750px; min-height:600px;">

        <!-- ajax loading gif -->
        <div id="loader">
          <img src="media/img/all/loader.gif" alt="loading" /><br />Loading...
        </div>
        
        <!-- the canvas for the visualization -->
        <div id="text_data">

        </div>
        
        <!-- Container for the visualization -->
        <div id="viz" style="width: 750px; min-height:520px"></div>
        
        <!-- Container for the key/legend -->
        <div class="key {{prod_class}}" style="min-height:50px"></div>
        
        <!-- Container for the timeline -->
         <div id="timeline">
          <div class="ui_bottom" id="ui_bottom" style="bottom:0px">
          </div>
          {% if app_name == "stacked" %}  
          <div id="stacked_controls" style="width:70%">
            <!-- <div>
              <p>Year Interval: </p>
              <div class="slider" id="interval"></div>
            </div> -->
            <div id="stacked_labels">
              <p>Labels:</p>
              <input type="radio" id="true" name="labels" checked="checked" /><label for="true">On</label>
              <input type="radio" id="false" name="labels" /><label for="false">Off</label>
            </div>
            <div id="stacked_layout">
              <p>Layout:</p>
              <input type="radio" id="value" name="layout" checked="checked" /><label for="value">Value</label>
              <input type="radio" id="share" name="layout" /><label for="share">Share</label>
            </div>
            <div id="stacked_order">
              <p>Ordering:</p>
              <input type="radio" id="community" name="order" checked="checked" /><label for="community">Community</label>
              <input type="radio" id="totals" name="order" /><label for="totals">Totals</label>
            </div>
            {% if app_type != "sapy" %} 
            <div id="stacked_capita" style="margin-left:40px">
              <p>Adjust:</p>
              <span style="">
                <input type="radio" id="current" name="capita" checked="checked" /><label style="margin-top:4px" for="current">Current</label>
                <input type="radio" id="notpc_constant" name="capita" /><label for="notpc_constant">Constant</label>
              </span>
              <span style="">
                <input type="radio" id="pc_current" name="capita" /><label style="" for="pc_current">Per Capita Current</label>
                <input type="radio" id="pc_constant" name="capita" /><label for="pc_constant">Per Capita Constant</label>
              </span>
            </div>
            {% endif %}
          </div>  
          {% endif %}
          {% if app_name == "pie_scatter" %}
           <div id="pie_controls" style="margin-left:18px">
             <div id="pie_yvar">
               <p>Y-Axis:</p>
               <input type="radio" id="complexity" name="yvar" checked="checked" /><label for="complexity">Complexity</label>
               <input type="radio" id="opp_gain" name="yvar" /><label for="opp_gain">Opportunity Gain</label>
             </div>
             <div id="pie_spot">
               <p>Spotlight:</p>
               <input type="radio" id="spot_off" name="pie_spot" checked="checked" /><label for="spot_off">Off</label>
               <input type="radio" id="spot_on" name="pie_spot" /><label for="spot_on">On</label>
             </div>
           </div>   
          {% endif %}


<!-- Those used to be in the right side bar -->

        <style>
        div.btn_label {
          font-size: 12px;
          font-weight: bold;
          display: inline-block;
          float: left;
          height: 20px;
          line-height: 20px;
          padding: 4px 5px;
          color: #333333;
        }
        </style>

        <div id="ui_bottom" style="bottom: 0px;"><div id="key" style="padding: 5px 0px 2px 5px;">


        </div>


        </div>


        <div class="product_class" style="float:left;">
          
          <span class="definition" style="font-weight:bold;">Product classification:</span>
          
          <!--
          <select>
            <option value="sitc4" {% if prod_class == "sitc4" %} selected="selected" {% endif %}>SITC4</option>
            <option value="hs4" {% if prod_class == "hs4" %} selected="selected" {% endif %}>HS4</option>
          </select>
          -->
          <div class="btn-group" id="viz_apps" data-toggle="buttons" style="margin-top:0px; margin-left:10px">
            <label class="btn btn-default {% if prod_class == "sitc4" %}active{% endif %}">
              <input type="radio" name="product_class" value="sitc4"> SITC4
            </label>
             <label class="btn btn-default {% if prod_class == "hs4" %}active{% endif %}">
              <input type="radio" name="product_class" value="hs4"> HS4
            </label>
          </div>

         {% if app_name == "map" %}

         <!-- TO BE IMPLEMENTED
          <b>Scale: </b>
          <div class="btn-group product_class">
            <label type="button" class="btn btn-default {% if prod_class == "sitc4" %}active{% endif %}" value="sitc4">Linear</label>
            <label type="button" class="btn btn-default {% if prod_class == "hs4" %}active{% endif %}" value="hs4">Log</label>
          </div>
          -->

         {% endif %}

        </div>
<!--
      {% if app_name != "product_space" %}
        {% if app_name != "map" %}
        <div class="nesting" style="float:left;">
          <span class="definition" style="font-weight:bold;">Details:</span>
          <select id="nesting_level" name="nesting" onchange="nest_drop_report(this.value)"> 
            <option value="nesting_0" >Low</option>
            {% if app_type == "casy" %}
            <option value="nesting_1">Mid</option>
            {% endif %}
            {% if app_type == "ccsy" %}
            <option value="nesting_1">Mid</option>
            {% endif %}
            <option value="nesting_2">Hi</option>
          </select>
        </div>  
        {% endif %}
      {% endif %}
-->

      {% if app_name != "product_space" %}
        {% if app_name != "map" %}
          
            <span class="definition" style="font-weight:bold; margin-left:20px;">Level of details:</span>
            
            <div class="btn-group" id="viz_apps" data-toggle="buttons" style="margin-top:0px; margin-left:20px">

            <label class="btn btn-default {% if prod_class == "sitc4" %}active{% endif %}">
                <input type="radio" name="product_class" value="sitc4"> Low
              </label>

              {% if app_type == "casy" %}
              <label class="btn btn-default {% if prod_class == "hs4" %}active{% endif %}">
                <input type="radio" name="product_class" value="hs4"> Mid
              </label>
              {% endif %}
              {% if app_type == "ccsy" %}
              <label class="btn btn-default {% if prod_class == "hs4" %}active{% endif %}">
                <input type="radio" name="product_class" value="hs4"> Mid
              </label>
              {% endif %}
              <label class="btn btn-default {% if prod_class == "hs4" %}active{% endif %}">
                <input type="radio" name="product_class" value="hs4"> Hi
            </label>
          </div>  
        {% endif %}
      {% endif %}

          
        </div>
       </div>  
           

       <style>

       #tool_pane  .glyphicon {
          font-size:18px;
           color:lightgray;
           margin:5px;
           cursor:pointer;
        }

       #tool_pane > .glyphicon:hover {
         color:black;
        }
       </style>


      <!-- The right pane -->
      <div id="tool_pane" style="width:50px">

        <h4 id="sidebar-create-story" data-toggle="tooltip" title="Create a new story and share it to the world!" style="border-bottom: solid 1px #999; font-family:'PT Sans Narrow',Helvetica,Arial; font-size:95%; font-weight:500; margin: 10px 0px; padding: 0 0 2px 0; text-align:center;">Tell-a-Story</h4>

        <span class="glyphicon glyphicon-plus-sign" onclick="showCreateStoryDialog()">&nbsp;</span>
        <span class="glyphicon glyphicon-list-alt" onclick="window.location.assign('stories/');">&nbsp;</span>
           

       {% if iscreatemode %}
         <span class="glyphicon glyphicon-plus" onclick="openCreateChapterDialog()"></span>
         <span class="glyphicon glyphicon-stop" onclick="endStory()"></span>
       {% endif %}   

       <br/>
       <br/>
          <!--
          <a href="#"><span class="glyphicon glyphicon-camera"></span></a>
          <a href="#"></a>
    -->
        <h4 style="border-bottom: solid 1px #999; font-family:'PT Sans Narrow',Helvetica,Arial; font-size:95%; font-weight:500; margin: 0; padding: 0 0 2px 0; margin: 10px 0px;  text-align:center;">Share this Page</h4>
    
        <a class="addthis_button_facebook"> <img src="media/img/all/facebook_badge.png" style="height:30px; margin: 5px 0px"/></a> 
        <a class="addthis_button_twitter" ><img src="media/img/all/twitter_badge.png" style="height:30px; margin: 5px 0px"/></a>
        <a
        class="addthis_button_google_plusone_share" ><img src="media/img/all/googleplus_badge.png" style="height:30px; margin: 5px 0px"/></a>
        <a class="addthis_button_email"><img src="media/img/all/email_badge.png" style="height:30px; margin: 5px 0px"/></a>
        
        <h4 style="border-bottom: solid 1px #999; font-family:'PT Sans Narrow',Helvetica,Arial; font-size:95%; font-weight:500; margin: 0; padding: 0 0 2px 0; ; margin: 10px 0px;  text-align:center;">Download</h4>
        
        <br>&nbsp;&nbsp;&nbsp;&nbsp;<...>
      
        <span class="glyphicon glyphicon-save" style="margin:5px; font-size:18px; color:lightgray"></span>

        <br>
        <br>
        <img src="media/img/app/text.png" style="width:20px" />
        <a class="text" href="#"> <span>{% trans "Data" %}</span></a>
        <br>
        <br>
        <br>

        <h4 style="border-bottom: solid 1px #999; font-family:'PT Sans Narrow',Helvetica,Arial; font-size:95%; font-weight:500; margin: 0; padding: 0 0 2px 0; ; margin: 10px 0px;  text-align:center;">Feedback</h4>
    
        <a href="https://docs.google.com/forms/d/1lj1okNNN4U7O6207dJwxG6i0Yp_NqH1mKFADW_rurfE/viewform" target="_blank"><span class="glyphicon glyphicon-envelope" style="margin:5px; font-size:18px; color:lightgray"></span></a>
            <br/>       <br/>
        <!--
        <!-- Trade Flow 
        {% if app_name != "pie_scatter" %}
        <div class="dropdown_container" id="trade_flow">
          <h3 class="definition">{% trans "Trade Flow" %}</h3>
          <select data-url_pos="5">
            {% for tf in trade_flow_list %}
            {% if tf.0 == trade_flow %}
            <option value="{{tf.0}}" selected="selected">{{ tf.1 }}</option>
            {% else %}
            <option value="{{tf.0}}">{{ tf.1 }}</option>
            {% endif %}
            {% endfor %}
          </select>
        </div>
        {% endif %}
        <!-- Country List 
        {% if country1_list  %}
        <div class="dropdown_container" id="country1">
          {% if country2_list %}
          <h3>{% trans "Origin Country" %}</h3>
          {% else %}
          <h3>{% trans "Country" %}</h3>
          {% endif %}
          <select data-url_pos="5">
            {% for c in country1_list %}
            {% if c.id == country1.id %}
            <option value="{{c.name_3char|lower}}" selected="selected">{{ c.name }}</option>
            {% else %}
            <option value="{{c.name_3char|lower}}">{{ c.name }}</option>
            {% endif %}
            {% endfor %}
          </select>
        </div>
        {% endif %}

        <!-- Country List 
        {% if country2_list %}
        <div class="dropdown_container" id="country2">
          <h3>{% trans "Destination Country" %}</h3>
          <select data-url_pos="5" id="country2_select">
            {% for c in country2_list %}
            {% if c.id == country2.id %}
            <option value="{{c.name_3char|lower}}" selected="selected">{{ c.name }}</option>
            {% else %}
            <option value="{{c.name_3char|lower}}">{{ c.name }}</option>
            {% endif %}
            {% endfor %}
          </select>
        </div>
        {% endif %}
        
        <!-- Product List 
        {% if product_list %}
        <div class="dropdown_container" id="product">
          <h3>{% trans "Product" %}</h3>
          <select data-url_pos="5">
            {% for p in product_list %}
            {% if p.id == product.id %}
            <option value="{{p.code}}" selected="selected">{{ p.name }}</option>
            {% else %}
            <option value="{{p.code}}">{{ p.name }}</option>
            {% endif %}
            {% endfor %}
          </select>
        </div>
        {% endif %}
        
        <!-- Year List 
        {% if year2_list %}
        <div class="dropdown_container" id="year_start">
          <h3>{% trans "Start Year" %}</h3>
        {% else %}
        <div class="dropdown_container" id="year">
          <h3>{% trans "Year" %}</h3>
          {% endif %}
          <select data-url_pos="5" id="year1_select">
            {% for y in year1_list %}
            {% if y == year or y == year_start %}
            <option value="{{y}}" selected="selected">{{ y }}</option>
            {% else %}
            <option value="{{y}}">{{ y }}</option>
            {% endif %}
            {% endfor %}
          </select>
        </div>
        
        <!-- Year2 List 
        {% if year2_list %}
        <div class="dropdown_container" id="year_end">
          <h3>{% trans "End Year" %}</h3>
          <select data-url_pos="5">
            {% for y in year2_list %}
            {% if y == year_end %}
            <option value="{{y}}" selected="selected">{{ y }}</option>
            {% else %}
            <option value="{{y}}">{{ y }}</option>
            {% endif %}
            {% endfor %}
          </select>
        </div>
        {% endif %}
        
        <!-- Year interval List 
        {% if year_interval_list %}
        <div class="dropdown_container" id="year_interval" style="display:none">
          <h3>{% trans "Year Interval" %}</h3>
          <select data-url_pos="5">
            {% for i in year_interval_list %}
            {% if i == year_interval %}
            <option value="{{i}}" selected="selected">{{ i }}</option>
            {% else %}
            <option value="{{i}}">{{ i }}</option>
            {% endif %}
            {% endfor %}
          </select>
        </div>
        {% endif %}

        <button id="build">{% trans "Build Visualization" %} &raquo;</button>

        -->

      </div> <!-- END Right pane -->
    </div> <!-- END #main -->

    <footer>
      <p>
        <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/InteractiveResource" property="dct:title" rel="dct:type">The Observatory of Economic complexity</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://atlas.media.mit.edu/" property="cc:attributionName" rel="cc:attributionURL">Alexander Simoes</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.<br />Permissions beyond the scope of this license may be available at <a xmlns:cc="http://creativecommons.org/ns#" href="http://atlas.media.mit.edu/about/permissions/" rel="cc:morePermissions">http://atlas.media.mit.edu/about/permissions/</a>.
        <br />
        <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" /></a>
      </p>

      <p style="margin-left:auto; margin-right:auto; width:40%;">
        <img src="media/img/all/logo_macro.png" alt="MIT MacroConnections Logo" style="float:left"/>
        <img src="media/img/all/logo_cid.png" alt="Center for International Development Logo" style="float:left"/>		
        <div class="language_select" style="float:left; margin-top:-10px">
          <div class="text">
            Language:
          </div>
          <select>
            {% for lang in supported_langs %}
            <option style="width: 70px; padding-right: 26px;" value="{{lang.0.code}}" {% if lang.0.code == LANGUAGE_CODE %} selected="selected" {% endif %}>{{lang.0.name_local}}</option>
            {% endfor %}
          </select>
        </div>
      </p>

    </footer>
    
    <form class="download" method="POST" action="/download/">
      {% csrf_token %}
      <input type="hidden" name="url" value="" />
      <input type="hidden" name="title" value="" />
      <input type="hidden" name="format" value="svg" />
      <input type="hidden" name="content" value="" />
    </form>

    <canvas style="display: none;" id="canvas" width="750px" height="520px"></canvas>
    
    <!--  Related -->
    <!-- <div id="related">
      <a id="prev" href="#">&laquo;</a>
      <a id="next" href="#">&raquo;</a>
      <a id="toggle" href="#">Related</a>
      <div>
        <p>
          Show related countries based on 
          <select>
            <option value="833">GNI per capita</option>
            <option value="804">GDP</option>
            <option value="1151">Population</option>
            <option value="0">Productive Structure</option>
            <option value="704">Exports of goods and services</option>
          </select>
        </p>
        <div class="related_item">
          <h4><img src="/media/img/icons/flag_wld.png">&nbsp;</h4>
          <iframe src="" width="180" height="140" frameborder="0"></iframe>
          <p class="value">&nbsp;</p>
          <p class="rank">&nbsp;</p>
        </div>
        <div class="related_item">
          <h4><img src="/media/img/icons/flag_wld.png">&nbsp;</h4>
          <iframe src="" width="180" height="140" frameborder="0"></iframe>
          <p class="value">&nbsp;</p>
          <p class="rank">&nbsp;</p>
        </div>
        <div class="related_item">
          <h4><img src="/media/img/icons/flag_wld.png">&nbsp;</h4>
          <iframe src="" width="180" height="140" frameborder="0"></iframe>
          <p class="value">&nbsp;</p>
          <p class="rank">&nbsp;</p>
        </div>
        <div class="related_item">
          <h4><img src="/media/img/icons/flag_wld.png">&nbsp;</h4>
          <iframe src="" width="180" height="140" frameborder="0"></iframe>
          <p class="value">&nbsp;</p>
          <p class="rank">&nbsp;</p>
        </div>
        <div class="related_item">
          <h4><img src="/media/img/icons/flag_wld.png">&nbsp;</h4>
          <iframe src="" width="180" height="140" frameborder="0"></iframe>
          <p class="value">&nbsp;</p>
          <p class="rank">&nbsp;</p>
        </div>
      </div>
    </div> -->
    
  </div> <!-- END #container -->

  <!-- The JavaScript -->
  <!-- Libraries -->
  <script src="media/js/libs/jquery/jquery-1.10.2.js"></script>
  <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script> 

  <script src="media/js/libs/tipsy/tipsy.jquery.js" ></script>

  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

  <script src="//s7.addthis.com/js/300/addthis_widget.js"></script>

  <script src="media/js/libs/bootstrap/js/bootstrap.js"></script>
  <script src="media/js/libs/chosen/chosen.jquery.js" ></script>
  <script>
    $(function() {
      $('.chosen-select').chosen();
      $('.chosen-select-deselect').chosen({ allow_single_deselect: true });
    });
  </script>

  <!-- App -->
  <script src="media/js/explore/general.js"></script>
  <script src="media/js/story/createStory.js"></script> 
  <script src="media/js/explore/key.js"></script>
  <script src="media/js/explore/timeline.js"></script>
  <script src="media/js/explore/controls.js"></script>
  <script src="media/js/apps/related.js"></script>
  <script src="media/js/libs/vizwiz/lib/d3.js"></script>
  <script src="media/js/libs/vizwiz/lib/modernizr.custom.js"></script>
  <script src="media/js/libs/vizwiz/src/general.js"></script>
  <script src="media/js/libs/vizwiz/src/utils.js"></script>
  <script src="media/js/libs/vizwiz/src/tooltip.js"></script>
  <script src="media/js/libs/vizwiz/src/utils.slider.js"></script>
  <script src="media/js/libs/vizwiz/src/viz/viz.js"></script>
  {% if app_name == "tree_map" %}<script src="media/js/libs/vizwiz/src/viz/tree_map.js"></script>{% endif %}
  {% if app_name == "stacked" %}<script src="media/js/libs/vizwiz/src/viz/stacked.js"></script>{% endif %}
  {% if app_name == "pie_scatter" %}<script src="media/js/libs/vizwiz/src/viz/pie_scatter.js"></script>{% endif %}
  {% if app_name == "product_space" %}<script src="media/js/libs/vizwiz/src/viz/network.js"></script>{% endif %}
  {% if app_name == "map" %}<script src="media/js/apps/map.js"></script>{% endif %}
  <script src="media/js/explore/viz_general.js"></script> 


  <!-- Glossary -->
  <div id="glossary" style="display:none;">
    {% include "about/glossary_text.html" %}
  </div>

  <script>
    $("#glossary h4").each(function(index) {
        if($("#glossary").length > 0) {
          var word = $(this).text();
          var definition = $("#glossary").find("p")[index].innerHTML;

          $(".definition").each(function () {
            // Update all instances of that word in the content page with mouse over def.
            var html = $(this).html();
            html = html.replace(new RegExp(word, 'g'), '<font class="definition trigger-link" data-container="body" data-toggle="popover" data-placement="top" data-content="'+definition+'" title="<b>'+word+'</b>">'+word+'</font>');
            $(this).html(html);
           $(this).children().popover({ html: true, trigger: "hover", delay: { show: 1000, hide: 100, title: "word"}});

          });
        }  
    });

  </script> 

  {% include "story/init_story.html" %}

  <script>
  // google analytics
  var _gaq=[['_setAccount','UA-22403682-3'],['_trackPageview']]; 
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
  
  // variables from server
  var app,
    app_types = ["tree_map", "stacked", "product_space", "pie_scatter", "map"],
    app_type ="{{app_type}}",
    warning = "{{warning}}",
    is_alert = "{{alert}}",
    api_uri = "{{api_uri}}",
    year =  "{{year}}",
    app_name = "{{app_name}}",
    years_available = {{years_available|safe}},
    trade_flow = "{{trade_flow}}",
    country1 = "{{country1}}",
    country2 = "{{country2}}",
    product = "{{product}}",
    item_type = "{{item_type}}",
    lang= "{{lang}}",
    embed=false,
		redesign_api_uri = "{{redesign_api_uri}}",
    year_start = "{{year_start}}",
    year_end = "{{year_end}}",
    product_code = "{{product_code}}",
    prod_class = "{{prod_class}}";
  
  // Use chosen plugin to make dropdowns look fancy
  $(".dropdown_container select").chosen()
  $(".nesting select").chosen()
  // language select dropdown
  $(".language_select select").chosen();
  $(".language_select .chzn-search").hide();
  $(".language_select select").chosen().change(function(){
    // set session data to new language
    var language = $(this).val();
    window.location = "/set_language/"+language+"/";
  });
  
  // set active link in top nav for current page
  var current_page = "explore";
  $("nav ul a").each(function(i, el){
    if($(el).text().toLowerCase() == current_page){
      $(el).addClass("current");
    }
  })
  
  // Check to see if the title overflows (in the case of long product names)
  function isOverflowed(element){
      return element.scrollHeight > element.clientHeight || element.scrollWidth > element.clientWidth;
  }
  
  var title = d3.select("#title")
  isOverflowed(title.node()) ? $("#title").children().css("font-size","26px") : console.log("fits") 

  // Allllllright, here goes. The meat and potatoes. The big kahuna...
  // whatever you wanna call it. This is the single most important function.
  // It triggers the data call to the server to fetch the data used in turn
  // to build the app. Look in viz_general.js for more info.
  build_viz_app(api_uri, 750, 520);


  </script>
   {% include "story/body_story.html" %}
  <script>

  $(function () {

        $(this).scrollTop(0);

    $(".chosen-select").chosen(); 
    $('.chosen-container').css('width', '150px');
    $('#country1_select_chosen').css('width', '170px');
    //$('#country1_select_chosen').css('font-size', '18px');    
    $('#year1_select_chosen').css('width', '60px');
    $('#year2_select_chosen').css('width', '80px');


    $('#country_trade_partner_select_chosen').css('width', '140px');
    $('#country_product_select_chosen').css('width', '140px');
      // new one

   // $('.chosen-select').chosen();
    $('.chosen-select-deselect').chosen({ allow_single_deselect: true });

      // TODO: reduce into one single selector
      $("#treemap_viz").popover({ html: true, trigger: "hover", delay: { show: 1000, hide: 100, title: "word"}});
      $("#map_viz").popover({ html: true, trigger: "hover", delay: { show: 1000, hide: 100, title: "word"}});

      $("#sidebar-create-story").tooltip();


      // get all list elements

      // set the

      //$("#country1").find(":selected").val();
/*
      $("#country1_select").find("*").each(function(i) {
        console.log("val", i, $(this).val());
      });

      $(".active-result").find("*").each(function(i) {
        console.log("val", i, $(this).val());
      });
      
*/
    });


    $( "#select-country-trade-partner" ).change(function() {
    
      // If billateral then only treemap
      if($(this).val()!="") {

        $("#map_viz").removeClass("active");
        $("#map_viz").prop("disabled", true);

        $("#treemap_viz").removeClass("active");
        $("#treemap_viz").addClass("active");

      }
    });


    $(function () {
      $('#myTab a').click(function (e) {
        e.preventDefault()
        $(this).tab('show')
      })
    });
  </script>


    <style>



      /* <ul class="chosen-results">
      <li class="active-result" style="" data-option-array-index="194">Turks and Caicos Islands</li>
      */

      .chosen-results li.active-result[data-option-array-index="194"] {
        background: url('media/img/icons/flag_fra.png') no-repeat;
      }


      #country1 .chosen-results li.active-result {
        background-size:25px;
        padding-left: 25px;
        margin-top:-4px;
      }
     

      #country1 .chosen-results li:hover {
        background-size:25px;
        padding-left: 25px;
        margin-top:-4px;
        background-color: lightblue;
      }
     
     /*

      #country1 .chosen-single span {
        background: url('media/img/icons/flag_usa.png') no-repeat;
        background-size:25px;
        padding-left: 30px;
        margin-top:-2px;
      }
*/

      /*
      li.active-result { 
          background: url('/media/img/icons/flag_fra.png') no-repeat;
        background-size:25px;
        padding-left: 30px;
        margin-top:-2px;  
      }
   
      .chosen-results, .chosen-single { 
          background: url('/media/img/icons/flag_usa.png') no-repeat;
        background-size:25px;
        padding-left: 30px;
        margin-top:-2px;  
      } */
    </style>

  </body>

  {% include "story/story_forms.html" %}


</html>