{% load i18n %}
{% load humanize %}
{% load compress %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  {% if displayviz %}
  <meta property="og:image" content="http://atlas.cid.harvard.edu/static_image/{{ displayImage }}"/>
  {% else %}
  <meta property="og:image" content="http://atlas.cid.harvard.edu/media/img/empty_static_200x200.png"/>
  {% endif %}
  <meta name="twitter:card" content="photo">
  <meta name="twitter:site" content="@Atlas_facts">
  <meta name="twitter:creator" content="@Atlas_facts">
  <meta name="twitter:title" content="{% if title %}{{title}} @Atlas_facts {% else %} The Atlas Of Economic Complexity {% endif %}">
  {% if displayviz %}
  <meta name="twitter:image:src" content="http://atlas.cid.harvard.edu/static_image/{{ displayImage }}"/>
  {% else %}
  <meta name="twitter:image:src" content="http://atlas.cid.harvard.edu/media/img/empty_static_200x200.png"/>
  {% endif %}
  <meta name="twitter:domain" content="http://www.atlas.cid.harvard.edu/">
  <link rel="search" type="application/opensearchdescription+xml" href="{{HTTP_HOST}}opensearch.xml" title="Atlas of Economic Complexity"/>
  <base href="{{HTTP_HOST}}">
  <title>{% if title %}{{title}} | {% else %}{% endif %}The Atlas Of Economic Complexity</title>
  <meta name="description" content="{{title}} The Atlas of Economic Complexity lets you interactively visualize a countryâ€™s trade and explore growth opportunities for more than a hundred countries worldwide.">
  <!-- Necessary for google to crawl the site, since it is purely ajax based.
        When the crawler reaches the page it will request the current URL plus
        the additional URL query parameter _escaped_fragment_= -->
  <meta name="fragment" content="!">

  <link rel="shortcut icon" type="image/x-icon" href="{{ STATIC_URL }}img/favicon.ico">

  {% compress css %}
  <link rel="stylesheet" href="{{ STATIC_URL }}js/libs/bootstrap/css/bootstrap.css"/>
  <link rel="stylesheet" href="{{ STATIC_URL }}css/normalize.css">
  <link rel="stylesheet" href="{{ STATIC_URL }}css/style.css?{{ VERSION }}">
  <link rel="stylesheet" href="{{ STATIC_URL }}css/style.css?{{ VERSION }}">
  <link rel="stylesheet" href="{{ STATIC_URL }}css/explore.css">
  <link rel="stylesheet" href="{{ STATIC_URL }}js/libs/toastr/toastr.min.css" />
  <link rel="stylesheet" href="{{ STATIC_URL }}js/libs/vizwiz/src/utils.slider.css?{{ VERSION }}" />
  <link rel="stylesheet" href="{{ STATIC_URL }}js/libs/bootstro/bootstro.min.css"/>
  <link rel="stylesheet" href="{{ STATIC_URL }}js/libs/jquery-ui/jquery-ui.css" />
  <link rel="stylesheet" href="{{ STATIC_URL }}css/widgets.css?{{ VERSION }}">
  <link href="{{ STATIC_URL }}js/libs/vizwiz/src/vizwhiz.d3.css" rel="stylesheet">
  <link href="{{ STATIC_URL }}js/libs/d3plus/d3plus.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ STATIC_URL }}css/searchresults.css" />
  {% endcompress %}

  <link rel='stylesheet' type='text/css' href='{{ STATIC_URL }}/js/libs/tipsy/tipsy.css'>
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/select2/3.4.8/select2.css" />
  <link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow' rel='stylesheet' type='text/css' />

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>
<body class="app" >
<script>
  var list_viz = ["tree_map", "map", "stacked", "product_space", "pie_scatter", "rings", "scatterplot", "rankings"];
  var dev = {% if DEV %}true{% else %}false{% endif %}; // Variable used mostly to be more verbose for debug
</script>
{% if not display_iframe %}

  {% if alert %}
  <div class="alert">
    <div>
      {% if alert.title %}
      <h4>{{alert.title}}</h4>
      {% endif %}
      {% if alert.text %}{{alert.text|safe}}{% endif %}
    </div>
  </div>
  {% endif %}
  {% if warning %}
  <div class="warning">
    <div>
      {% if warning.title %}
      <h4>{{warning.title}}</h4>
      {% endif %}
      {% if warning.text %}{{warning.text|safe}}{% endif %}
    </div>
  </div>
  {% endif %}
  <div id="container">
    <header>
     <div class="logo" style="background-color: #fafafa; width:165px; height:66px;">
        <a href="" title="Home" style="text-decoration: none;">
        <h1 style="background: url({{ STATIC_URL }}img/all/logo_rainbow.png) repeat-x 100% 100%; padding-bottom:22px; color: black; font-size:43px;">The Atlas</h1>

        <h2 style="font-size:14px; margin-top:-25px; text-align:center; margin-left:0px; letter-spacing:1px; color:white; text-transform:uppercase; text-decoration:none; background-color: #a0a6a9;" class="element">of Economic Complexity</h2></a>
      </div>
      <nav>
        <ul>
          <li><a {% if isbrowsemode %}href="endbrowse"{% else %}href="explore/"{% endif %}>{% trans "Explore" %}</a></li>
          <li><a href="rankings/">{% trans "Rankings" %}</a></li>
          <li><a id="newBook" href="book/">{% trans "New Book" %}</a></li>
          <li><a href="about/glossary/">{% trans "Glossary" %}</a></li>
          <li><a href="about/">{% trans "About" %}</a></li>
        </ul>
      </nav>
      <br class="clear">
    </header>
    <div id="main" role="main">
      {% if userId %}
       <div id="userSession">
       	 <button id="logoutBtn"  onclick="location.href='logout/'" style="font-family: inherit;">Logout</button>
       	 <p id="loggedInUser">Hello {{ userName }}</p>
       </div>
       {% endif %}
      <div class="app_title" id="icons" style="width:230px; height:60px; margin-left:10px;">

        <ul class="nav nav-tabs" id="myTab">
          <li class="active"><a href="#tab-countries"><span class="glyphicon glyphicon-globe"></span>  <span style="font-size:18px;">{% trans "World Data" %}</span></a></li>
        </ul>

      </div>

      <style type="text/css">
      .typed-cursor {
          opacity: 1;
          -webkit-animation: blink 0.7s infinite;
          -moz-animation: blink 0.7s infinite;
          animation: blink 0.5s infinite;
          font-size: 32px;
      }
      @keyframes blink{
          0% { opacity:1; }
          50% { opacity:0; }
          100% { opacity:1; }
      }
      @-webkit-keyframes blink{
          0% { opacity:1; }
          50% { opacity:0; }
          100% { opacity:1; }
      }
      @-moz-keyframes blink{
          0% { opacity:1; }
          50% { opacity:0; }
          100% { opacity:1; }
      }
      </style>

      <!-- The title -->
      <div class="app_title" id="title"  original-title='{% trans "Economic Complexity" %}'>
        <h2 style="margin-left:10px; width:700px;"></h2>
        
        <input type='text' id='atlas-search-js' value="{% if title %}{{title}}{% else %}&nbsp;{% endif %}" data-toggle="tooltip" class="tab-content bootstro" data-bootstro-content="<span style='font-size:20px; color:red'>NEW</span><br><span style='font-size:18px'>Titles on the page are now <b>interactive!</b> Type in any <b>Country</b> (France, Germany) or <b>Product</b> (Cars, Horses) and let the magic begin.</span>" data-bootstro-placement="left"/>

<!--        <span id="text_title">{% if title %}{{title}}{% else %}&nbsp;{% endif %}</span><span id="text_blink"></span> -->

        
      </div>

      <br style="clear:both">


      <!-- The left pane -->
      <div id="app_pane" style="width:230px; height:810px;">
        <div data-toggle="tooltip" class="tab-content bootstro" data-bootstro-title="Query" data-bootstro-content="The first thing you need to do is decide what question you are trying to answer. Perhaps, what products did the United States export in 2000? Or how has its import basket changed in the last ten years?  Once you have decided your query, you can enter the information you need to answer this in the left-hand bar." data-bootstro-placement="right">

          <!-- Country selection -->
          <div class="tab-pane active" id="tab-countries">
            <span title="0 void" toolTip="2" style="margin:10px 0px; font-weight:bold;">{% trans "Select a Country" %}</span>
            <div id="country1" width="190px" style="margin-left: 0px;">

                <select  id="country1_select" style="width:190px">

                <option value=""></option>
              </select>
            </div>

            <br>

        <!-- TRADE / DIVERSIFICATION -->

          <!-- Country selection -->
          <div class="tab-pane active" id="tab-trade">

          <div id="trade_flow" style="margin-left: -5px;">

            <div class="btn-group flow-direction" data-toggle="buttons" style="margin-top:5px; margin-left:5px">
              <label class="btn btn-default {% if trade_flow == "export" or trade_flow == "net_export" %} active{% endif %}">
                <input type="radio" name="flow_direction" value="export" onchange="$('.flow-direction').children().eq(1).removeClass('active'); $(this).parent().addClass('active');update_viz();"><i style="padding:0;"class="fa fa-sign-out"></i>&nbsp;&nbsp;{% trans "Exports" %}&nbsp;
              </label>
              <label class="btn btn-default {% if trade_flow == "import" or trade_flow == "net_import" %} active{% endif %}  {% if app_name == "product_space" or app_name == "pie_scatter" or app_name == "rings" %} disabled{% endif %}">
                <input type="radio" name="flow_direction" id="flow_direction" value="import" onchange="$('.flow-direction').children().eq(0).removeClass('active'); $(this).parent().addClass('active');update_viz();"><i style="padding:0;" class="fa fa-sign-in fa-flip-horizontal"></i>&nbsp;&nbsp;{% trans "Imports" %}&nbsp;
              </label>
            </div>
          </div>

          <ul class="nav nav-tabs tab-trade-partner-product" id="myTab" style="margin-top: 20px; margin-left:0px; width:200px;">
            <li{% if prod_or_partner == "product" %} class="active"{% endif %}><a href="#show-country-product"><span class="glyphicon glyphicon-barcode" style="font-size:14px; color:gray;"></span>  <span style="font-size:14px; color:gray;">{% trans "Product" %}</span></a></li>
            <li{% if prod_or_partner == "partner" %} class="active"{% endif %}><a href="#show-country-partner"><span class="glyphicon glyphicon-globe" style="font-size:14px; color:gray;"></span> <span style="font-size:14px;">{% trans "Partner" %}</span></a></li>
          </ul>

          <!-- Tab Trade Partner/Product -->
          <div class="tab-content" style="height:50px; border: solid 1px #e6e6e6; border-top: 0px; padding-top:10px; width:200px; margin-left:0px; height:60px">

            <div class="tab-pane {% if prod_or_partner == "product" %} active{% endif %}" id="show-country-product">

              <div id="country-product" width="170px" style="margin-left:10px;">

                <select  id="country_product_select" style="width:170px">
                <option value=""></option>

                </select>
              </div>
            </div>

            <div class="tab-pane {% if prod_or_partner == "partner" %} active{% endif %}" id="show-country-partner">

              <div id="country-trade-partner" width="170px" style="margin-left: 10px;">

                  <select  id="country_trade_partner_select" style="width:170px;">
                    <option value=""></option>
                  </select>
              </div>
            </div>

          </div>

          <!-- App selection -->
          <div style="font-weight:bold; margin-top:0px; margin-left:5px">
          <br>
          {% trans "Trade Data Visualization" %}</div>

          <div id="tfViz" data-toggle="buttons" style="margin-left:5px;">

            <label value="tree_map" class="btn btn-default {% if app_name == 'tree_map' %}active{% endif %} tooltipbs" data-placement="top" data-toggle="tooltip" title ="Tree Map">
              <input type="radio" style="background:url({{ STATIC_URL }}img/common/treemap.png) no-repeat;">
              <img src="{{ STATIC_URL }}img/common/treemap.png" style="width:38px;"/>
            </label>

            <label value="map" class="btn btn-default {% if app_name == 'map' %}active{% endif %}" data-placement="top" data-toggle="tooltip" title="Map" >
              <input type="radio" style="background:url({{ STATIC_URL }}img/common/geo.png) no-repeat;">
              <img src="{{ STATIC_URL }}img/common/geo.png" style="width:38px;"/>
            </label>

            <label value="stacked" class="btn btn-default {% if app_name == 'stacked' %}active{%endif%} tooltipbs" data-placement="top" data-toggle="tooltip" title={% trans "Stacked Graph" %} >
              <input type="radio" name="viz_apps">
              <img src="{{ STATIC_URL }}img/common/stackedgraph.png" style="width:38px;"/>
            </label>

            {% if app_name == 'scatterplot' or app_name == 'rankings' %}
              <label value="scatterplot" class="btn btn-default {% if app_name == 'scatterplot' %}active{% endif %}" data-placement="top" data-toggle="tooltip" title="Scatter Plot" >
              <input type="radio" name="viz_apps"> <img src="{{ STATIC_URL }}img/home/scatterplot-thumb.png" style="width:38px;"/>
              </label>

              <label value="rankings" class="btn btn-default {% if app_name == 'rankings' %}active{% endif %}" data-placement="top" data-toggle="tooltip" title="Rankings" >
              <input type="radio" name="viz_apps"> <img src="{{ STATIC_URL }}img/home/rankings-thumb.png" style="width:38px;"/>
              </label>
            {% endif %}

            <div style="font-weight:bold; margin-top:0px; margin-left:5px">
            <br>

            {% trans "Complexity Visualization" %}</div>

            <label value="product_space" class="btn btn-default {% if app_name == 'product_space' %}active{% endif %}" data-placement="top" data-toggle="tooltip" title="Product & Country Space" >
              <input type="radio" style="background:url({{ STATIC_URL }}img/common/productspace.png) no-repeat;">
              <img src="{{ STATIC_URL }}img/common/productspace.png" style="width:38px;"/>
            </label>

            <label value="pie_scatter" class="btn btn-default {% if app_name == 'pie_scatter' %}active{% endif %}" data-placement="top" data-toggle="tooltip" title="Product Feasibility" >
              <input type="radio" style="background:url({{ STATIC_URL }}img/common/feasibility.png) no-repeat;">
              <img src="{{ STATIC_URL }}img/common/feasibility.png" style="width:38px;"/>
            </label>

            <label value="rings" class="btn btn-default {% if app_name == "rings" %}active{%endif%} tooltipbs" data-placement="top" data-toggle="tooltip" title="Rings" >
              <input type="radio" name="viz_apps">
              <img src="{{ STATIC_URL }}img/home/rings-thumb.png" style="width:38px;"/>
            </label>
          </div>

          </div>
        </div>

  <!-- END -->
  </div>

  <!-- Year tab -->
   <div class="tab-content" style="display:block">
    <ul class="nav nav-tabs" id="myTab">
      <li class="active"><a href="#country-year"><span class="glyphicon glyphicon-calendar"></span> <span style="font-size:16px;">{% trans "Time Period" %}</span></a></li>
    </ul>

    <div class="tab-content" style="height:50px; border: solid 1px #e6e6e6; border-top: 0px; padding-top:10px;">

      <div class="tab-pane active" id="country-year">

           <select id="year1_select" style="margin-left: 10px;">
            {% for y in year1_list %}
            {% if y == year or y == year_start %}
            <option value="{{y}}" selected="selected">{{ y }}</option>
            {% else %}
            <option value="{{y}}">{{ y }}</option>
            {% endif %}
            {% endfor %}
          </select>

          <select data-placeholder="End " id="year2_select" style="margin-left: 10px;">
            <option value=""></option>
            {% for y in year1_list %}
            {% if y == year_end %}
            <option value="{{y}}" selected="selected">{{ y }}</option>
            {% else %}
            <option value="{{y}}">{{ y }}</option>
            {% endif %}
            {% endfor %}
          </select>
      </div>

    </div>
</div>
<ul style="margin-bottom:0px; padding-bottom:0px;" class="nav nav-tabs" id="utilityBox">
{% if previous_image != "/media/img/all/loader.gif" %}
  <li class="active" id="historyTab"><a href="#history" data-toggle="tab">Previous Page</a></li>
  <li id="legendTab"><a href="#legendPane" data-toggle="tab">Legend</a></li>
{% else %}
  <li class="active" id="legendTab"><a href="#legendPane" data-toggle="tab">Legend</a></li>
{% endif %}
</ul>
<div class="tab-content" style="padding-top:0px;">
{% if previous_image != "/media/img/all/loader.gif" %}
  <div class="tab-pane active" id="history">
    <div id="historyBox">
      <div id="historyBoxInner">
        <a href="#"><i id="hnLeft" class="fa fa-chevron-left historyNav" style="opacity: 0"></i></a>
        <a id="historySlide"></a>
        <a href="#"><i id="hnRight" class="fa fa-chevron-right historyNav" style="opacity: 0"></i></a>
      </div>
    </div>
  </div>
  {% endif %}
    <div class="tab-pane {% if previous_image == "/media/img/all/loader.gif" %}active{% endif %}" id="legendPane">
      <div id="legend">
        <div id="helpBoxInner">
            <h3> </h3>
            <hr>
            <p>{% trans "Welcome to The Atlas of Economic Complexity. Hover over an element to see its function." %}</p>
        </div>
        {% if app_name == "product_space" or app_name == "pie_scatter" %}
        <ul>
        {% if app_name == "product_space" %}
          <li>
            <span><div id="legendComm"></div></span>
            <span><p>  = Product Community</p></span>
          </li>
          <li>
            <span><div id="legendConn"></div></span>
            <span><p>  = Link between Product Communities</p></span>
          </li>
        {% else %}
          <li>
            <span><div id="legendComm"></div></span>
            <span><p>  = Product Community (RCA > 1)</p></span>
          </li>
          <li>
            <span><div id="legendComm1"></div></span>
            <span><p>  = Product Community (RCA < 1)</p></span>
          </li>
          <li>
            <span id="legendPie">
              <div style="float:left; margin-right: 3px; width: 15px; height: 15px; position: relative; border-top-left-radius: 15px; border-top-right-radius: 15px; border-bottom-right-radius: 15px; border-bottom-left-radius: 15px; background-color: rgb(0,0,0);">
                <div style="position: absolute; top: 0px; left: 0px; width: 15px; height: 15px; border-top-left-radius: 15px; border-top-right-radius: 15px; border-bottom-right-radius: 15px; border-bottom-left-radius: 15px; clip: rect(0px 15px 15px 0px); -webkit-transform: rotate(0deg);">
                  <div style="position: absolute; top: 0px; left: 0px; width: 15px; height: 15px; border-top-left-radius: 15px; border-top-right-radius: 15px; border-bottom-right-radius: 15px; border-bottom-left-radius: 15px; clip: rect(0px 7px 15px 0px); -webkit-transform: rotate(180deg); background-color: rgb(0, 0, 0);">
                  </div>
                </div>
                <div style="position: absolute; top: 0px; left: 0px; width: 15px; height: 15px; border-top-left-radius: 15px; border-top-right-radius: 15px; border-bottom-right-radius: 15px; border-bottom-left-radius: 15px; clip: rect(0px 15px 15px 7px); -webkit-transform: rotate(180deg);">
                  <div style="position: absolute; top: 0px; left: 0px; width: 15px; height: 15px; border-top-left-radius: 15px; border-top-right-radius: 15px; border-bottom-right-radius: 15px; border-bottom-left-radius: 15px; clip: rect(0px 7px 15px 0px); -webkit-transform: rotate(180deg); background-color: rgb(0, 0, 0);">
                  </div>
                </div>
                <div style="position: absolute; top: 0px; left: 0px; width: 15px; height: 15px; border-top-left-radius: 15px; border-top-right-radius: 15px; border-bottom-right-radius: 15px; border-bottom-left-radius: 15px; clip: rect(0px 15px 15px 7px); -webkit-transform: rotate(360deg);">
                  <div style="position: absolute; top: 0px; left: 0px; width: 15px; height: 15px; border-top-left-radius: 15px; border-top-right-radius: 15px; border-width: 2px; border-bottom-right-radius: 15px; border-bottom-left-radius: 15px; clip: rect(0px 7px 15px 0px); -webkit-transform: rotate(90deg); background-color: rgb(255, 255, 255);">
                  </div>
                </div>
              </div>
            </span>
            <span><p> = current production vs potential production</p></span>
          </li>
        {% endif %}
        </ul>
        {% endif %}
      </div>
    </div>
  </div>
  <button name="button" id="help">{% trans "Help" %}</button>
</div> <!-- END app selection pane -->

{% endif %}
      <!-- the Visualization -->
      <div id="content"  class="container" style="{% if not display_iframe %} width: 750px; min-height:600px; {% else %} width: 100%; height:100%; {% endif %}">

        <div class="contentViz">
        <!-- ajax loading gif -->
          <div id="loader" style="position:absolute; margin-top:-23px">
          <!--if static image mode is PNG-->
          {% if displayviz %}
            <img src="static_image/{{displayImage}}" alt="loading" style="opacity:.9"/>
          {% else %}
            <img src="{{ STATIC_URL }}img/all/loader.gif" alt="loading" style="margin-top:200px" />
            <p>Loading</p>
          {% endif %}
          </div>

          <!-- the canvas for the visualization -->
          <div id="text_data"></div>
          <div id="historyOverlay"></div>
          <div id="refreshOverlay" onclick="update_viz();">
            <div id="refreshText">
              <i class="refreshIcon fa fa-refresh fa-4x"></i>
              <h1>Click Here To Refresh The Visualization</h1>
            </div>
          </div>
          <!-- Container for the visualization -->
          <div class="bootstro" data-bootstro-title="Visualization" data-bootstro-content="The visualization will appear here based off the query you implemented and application you chose." data-toggle="tooltip" data-bootstro-placement="left" id="viz" style="{% if not display_iframe %} width: 750px; min-height:520px; {% else %} width: 100%; height:100%; {% endif %}">
          </div>
		  </div>
{% if not display_iframe %}
        <div class="contentInner">
        <!-- Container for the key/legend -->
        <div class="key {{prod_class}}" style="min-height:50px"></div>
        <!-- Container for the timeline -->
         <div id="timeline" class="bootstro" data-bootstro-title="Options Panel" data-bootstro-content="The Options Panel changes based on the visualization that you've selected. Here, you can do things such as filter the results by country and product or even change the level of detail shown in the visualization." data-toggle="tooltip" data-bootstro-placement="left">

          <div id="ui_bottom" style="bottom: 0px; height:50px;">
            <div id="key" style="padding: 5px 0px 2px 5px;"></div>
          </div>
          <div class="row">
            {% if app_name != "product_space" %}
            <div class="vizControl col-md-4">
              <span class="definition" style="font-weight:bold;">{% trans "Product Class" %}</span>
              <div class="btn-group" id="viz_apps" data-toggle="buttons" style="margin-top:0px; margin-right:20px; height:34px;">
                <label class="btn btn-default {% if prod_class == "sitc4" %}active{% endif %}">
                  <input type="radio" onchange="queryActivated=true;queryParameters['prod_class'] = 'sitc4';updateURLQueryParameters();prod_class='sitc4';update_viz(app_name);"> SITC4
                </label>
                 <label class="btn btn-default {% if prod_class == "hs4" %}active{% endif %}">
                  <input type="radio" onchange="queryActivated=true;queryParameters['prod_class'] = 'hs4';updateURLQueryParameters();prod_class='hs4';update_viz(app_name);"> HS4
                </label>
              </div>
            </div>
            {% endif %}
            {% if app_name != "product_space" and app_name != "rings" and app_name != "map" %}
              <div class="vizControl col-md-4" >
                <span class="definition" style="font-weight:bold;">{% trans "Detail Level" %}</span>
                <div id="level_details" class="btn-group" data-toggle="buttons" style="margin-top:0px; margin-right:20px">
                  <label class="btn btn-default btn-detail {% if app_name == "stacked" %} active {% endif %}">
                    <input type="radio" name="level_detail" value="nesting_0" onchange="nest_drop_report(this.value);"> {%trans "Low"%}
                  </label>
                  {% if app_type == "casy" or app_type == "ccsy" %}
                  <label class="btn btn-default btn-detail">
                    <input type="radio" name="level_detail" value="nesting_1" onchange="nest_drop_report(this.value);" > {% trans "Mid" %}
                  </label>
                  {% endif %}
                  <label class="btn btn-default btn-detail {% if app_name != "stacked" %} active {% endif %}">
                    <input type="radio" name="level_detail" value="nesting_2" onchange="nest_drop_report(this.value);"> {%trans "Hi" %}
                  </label>
                </div>
              </div>
            {% endif %}

            {% if app_name != "product_space" and app_name != "rings" and app_name != "pie_scatter"%}
              <div class="vizControl col-md-4" >
                <span class="definition" style="font-weight:bold;">{% trans "Trade Flow" %}</span>
                <div class="btn-group flow-net-gross" data-toggle="buttons" style="margin-top:0px; margin-right:20px">
                  <label class="btn btn-default btn-detail {% if trade_flow == "import" or trade_flow == "export" %} active{% endif %}">
                    <input type="radio" value="gross" onchange="$('.flow-net-gross').children().eq(1).removeClass('active'); $(this).parent().addClass('active');update_viz();"> {% trans "Gross" %}
                  </label>
                  <label class="btn btn-default btn-detail {% if trade_flow == "net_import" or trade_flow == "net_export" %} active{% endif %}">
                    <input type="radio" value="net" onchange="$('.flow-net-gross').children().eq(0).removeClass('active'); $(this).parent().addClass('active');update_viz();"> {% trans "Net" %}
                  </label>
                </div>
              </div>
            {% endif %}
          </div>

          {% if app_name == "tree_map" or app_name == "map" %}
            <div class="vizControl col-md-6" >
              <span class="definition" style="font-weight:bold;">{% trans "Color by" %}</span>
              <div id="level_details" class="btn-group" data-toggle="buttons" style="margin-top:0px; margin-right:20px">
                <label class="btn btn-default btn-detail active">
                  <input type="radio" name="level_detail" value="nesting_0" onchange="d3.select('#viz').call(viz.color_var('color'))"> Category
                </label>
                <label class="btn btn-default btn-detail disabled">
                  <input type="radio" name="level_detail" value="nesting_2" onchange="display_growth(1);"> {% trans "Growth" %} 1-{% trans "year" %}
                </label>
                <label class="btn btn-default btn-detail disabled">
                  <input type="radio" name="level_detail" value="nesting_2" onchange="display_growth(2);"> {% trans "Growth" %} 5-{% trans "year" %}
                </label>
              </div>
            </div>
          {% endif %}

          {% if app_name == "stacked" %}
          <style type="text/css">.contentInner{height:300px;} #timeline{min-height: 227px}</style>
          <div>
          <div id="stacked_controls" style="float:left; width:100%; ">

          <div class="row">
            <div class="vizControl col-md-4">
              <span class="definition" style="font-weight:bold;">{% trans "Labels" %}</span>
              <div class="btn-group" data-toggle="buttons" style="margin-top:0px; margin-right:20px">
                <label class="btn btn-default active">
                  <input type="radio" id="true" name="labels" checked="checked">On
                </label>
                <label class="btn btn-default">
                  <input type="radio" id="false" name="labels" >Off
                </label>
              </div>
            </div>
            <div class="vizControl col-md-4">
            <span class="definition" style="font-weight:bold;">Layout</span>
              <div class="btn-group" data-toggle="buttons" style="margin-top:0px; margin-right:20px">
                <label class="btn btn-default active">
                  <input type="radio" id="value" name="layout" checked="checked">{% trans "Value" %}
                </label>

                <label class="btn btn-default">
                  <input type="radio" id="share" name="layout">{% trans "Share" %}
                </label>
              </div>
            </div>

            <div class="vizControl col-md-4">
            <span class="definition" style="font-weight:bold;">{% trans "Ordering" %}</span>
            <div class="btn-group" data-toggle="buttons" style="margin-top:0px; margin-right:20px">
              <label class="btn btn-default active">
                <input type="radio" id="community" name="order" checked="checked">{% trans "Community" %}
              </label>
              <label class="btn btn-default">
                <input type="radio" id="totals" name="order">{% trans "Totals" %}
              </label>
            </div>
            </div>
          </div>
          {% if app_type != "sapy" %}
          <div class="ui_bottom_row row">

              <div class="vizControl col-md-8">
                <span class="definition" style="font-weight:bold;">{% trans "Y-Axis" %}</span>
                <div class="btn-group" data-toggle="buttons" style="margin-top:0px; margin-right:20px">
                  <label class="btn btn-default active capita">
                    <input type="radio" id="current" name="capita" checked="checked"> {% trans "Current" %}
                  </label>
                  <label class="btn btn-default capita">
                    <input type="radio" id="notpc_constant" name="capita"> {% trans "Constant" %}
                  </label>
                  <label class="btn btn-default capita">
                    <input type="radio" id="pc_current" name="capita"> {% trans "Per Capita Current" %}
                  </label>
                  <label class="btn btn-default capita">
                    <input type="radio" id="pc_constant" name="capita"> {% trans "Per Capita Constant" %}
                  </label>
                </div>
              </div>
              <div class="vizControl col-md-4" style="float:left; margin-top:10px; position:relative; z-index:100;">
                <span class="definition" style="font-weight:bold; display:inline;">{% trans "Highlight" %}</span>
                <span id="highlight">
                    <select id="highlight_select" onchange="highlight();" style="width: 140px"><option/></select>
                </span>
              </div>

          </div>

            {% endif %}

            </div>
          </div>

          {% endif %}

          {% if app_name == "pie_scatter" %}
            <div class="product_class" style="float:left;">
              <span class="definition" style="font-weight:bold;">{% trans "Y-Axis" %} </span>
              <div class="btn-group" id="pie_controls" data-toggle="buttons" style="margin-right:10px;">
                <label class="btn btn-default active" id="yaxis-complexity" name="yvar" >
                  <input type="radio" id="complexity" name="yvar"> {% trans "Complexity" %}
                </label>
                <label class="btn btn-default" id="yaxis-opp_gain" >
                  <input type="radio" id="opp_gain" name="yvar"> Opportunity Gain
                </label>
              </div>
            </div>

            <div class="product_class" style="float:left;">
              <span class="definition" style="font-weight:bold;">Hide exports (Spotlight) </span>
              <div class="btn-group" id="pie_controls" data-toggle="buttons" style="margin-right:20px;">
                <label class="btn btn-default active" id="spot-off" name="yvar" >
                  <input type="radio" id="spot_off" name="pie_spot"> Off
                </label>
                <label class="btn btn-default" id="spot-on" >
                  <input type="radio" id="spot_on" name="pie_spot"> On
                </label>
              </div>
            </div>

            <div class="product_class" style="float:left;">
              <span class="definition">{% trans "Size by" %}</span>
              <div class="btn-group node_size" data-toggle="buttons" >
                <label type="button" class="btn btn-default disabled" value="none">
                  <input type="radio" name="node_size" value="none" onchange=""> None
                </label>
                <label type="button" class="btn btn-default active" value="world_trade">
                  <input type="radio" name="node_size" value="world_trade" onchange=""> {% trans "World Trade" %}
                </label>
              </div>
            </div>

            <p style="clear:both">

          {% endif %}

          {% if app_name == "scatterplot" %}

            {% if item_type == "product" %}

              <div class="product_class" style="float:left;">
                <span class="definition" style="font-weight:bold;">X-Axis </span>
                <div class="btn-group" data-toggle="buttons" style="margin-right:10px;">
                  <label class="btn btn-default active" >
                    <input type="radio" id="complexity" onchange="d3.select('#viz').call(viz.xaxis_var('distance'))"> Distance
                  </label>
                  <label class="btn btn-default">
                    <input type="radio" name="yvar" onchange="d3.select('#viz').call(viz.xaxis_var('pci'))"> PCI
                  </label>
                </div>
              </div>

              <div class="product_class" style="float:left;">
                <span class="definition" style="font-weight:bold;">{% trans "Y-Axis" %}  </span>
                <div class="btn-group" id="pie_controls" data-toggle="buttons" style="margin-right:10px;">
                  <label class="btn btn-default active" id="complexity" name="yvar" >
                    <input type="radio" id="complexity" name="yvar"> Current
                  </label>
                  <label class="btn btn-default" id="complexity" name="yvar" >
                    <input type="radio" id="complexity" name="yvar"> {% trans "Complexity" %}
                  </label>
                  <label class="btn btn-default" id="opp_gain" >
                    <input type="radio" id="opp_gain" name="yvar"> Opportunity Gain
                  </label>
                </div>
              </div>

              <div class="product_class" style="float:left;">
                <span class="definition">Size by</span>
                <div class="btn-group node_size" data-toggle="buttons" >
                  <label type="button" class="btn btn-default" value="none">
                    <input type="radio" name="node_size" value="none" onchange="d3.select('#viz').call(viz.value_var(''))"> None
                  </label>
                  <label type="button" class="btn btn-default active" value="world_trade">
                    <input type="radio" name="node_size" value="world_trade" onchange="d3.select('#viz').call(viz.value_var('share'))"> Current
                  </label>
                </div>
              </div>

            {% endif %}

            {% if item_type == "country" %}


            {% endif %}


            <p style="clear:both">

            <div class="product_class" style="float:left;">
              <span class="definition">Color by: </span>
              <div class="btn-group node_size" data-toggle="buttons" >
                <label type="button" class="btn btn-default active" value="world_trade">
                  <input type="radio" name="node_size" value="world_trade"> Category
                </label>
              </div>
            </div>

          {% endif %}

          {% if app_name == "product_space" %}

          <div class="vizControl col-md-4">
            <span class="definition" style="font-weight:bold;">{% trans "Product Class" %}:</span>
            <div class="btn-group" id="viz_apps" data-toggle="buttons" style="margin-top:0px; margin-right:20px; height:34px;">
              <label class="btn btn-default {% if prod_class == "sitc4" %}active{% endif %}">
                <input type="radio" onchange="queryActivated=true;queryParameters['prod_class'] = 'sitc4';updateURLQueryParameters();prod_class='sitc4';update_viz(app_name);"> SITC4
              </label>
               <label class="btn btn-default {% if prod_class == "hs4" %}active{% endif %}">
                <input type="radio" onchange="queryActivated=true;queryParameters['prod_class'] = 'hs4';updateURLQueryParameters();prod_class='hs4';update_viz(app_name);"> HS4
              </label>
            </div>
          </div>
          <div class="vizControl col-md-3">
            <span class="definition">Color</span>
            <div class="btn-group community" style="margin-right:20px;" data-toggle="buttons">
              <label type="button" class="btn btn-default active" value="category"> 
                <input type="radio" name="node_color" value="category" onchange="change_node_color(this.value)"> Category
              </label>
              <!--
              <label type="button" class="btn btn-default" value="pci">
                <input type="radio" name="node_color" value="pci" onchange="change_node_color(this.value)"> PCI
              </label>
              <label type="button" class="btn btn-default disabled" value="community">
                <input type="radio" name="node_size" value="none" onchange="change_node_size(this.value)"> Community
              </label>
              -->
            </div>
          </div>
          <div class="vizControl col-md-5">
            <span class="definition">Size</span>
            <div class="btn-group node_size" data-toggle="buttons">
              <label type="button" class="btn btn-default active" value="none">
                <input type="radio" name="node_size" value="none" onchange="change_node_size('none')"> None
              </label>
              <label type="button" class="btn btn-default" value="value">
                <input type="radio" name="node_size" value="world_trade" onchange="change_node_size('value')"> Country Trade
              </label>
              <label type="button" class="btn btn-default" value="world_trade">
                <input type="radio" name="node_size" value="world_trade" onchange="change_node_size('world_trade')"> World Trade
              </label>
            </div>
          </div>

          <div class="btn-group col-md-4" id="viz_apps" data-toggle="buttons" style="margin-top:20px;">
          <span class="definition" style="font-weight:bold;">
            Filter by RCA Threshold:<span id="rca-threshold" style="font-weight:normal;">1</span>
          </span>

          </br>

          0 <input type="range" name="points" min="0" max="10" step=".1" value="1" id="set-rca-threshold" onchange="updateRCA(this.value);"> 10
          </div>

         {% endif %}


         {% if app_name == "map" %}


          <b>{% trans "Color scale:" %}  </b>
          <div class="btn-group product_class">
            <label type="button" class="btn btn-default disabled" value="sitc4">Linear</label>
            <label type="button" class="btn btn-default active" value="hs4">Log</label>
          </div>

         {% endif %}

        {% if app_name == "product_space" or app_name == "pie_scatter" or app_name == "tree_map" or app_name == "rings" %}
        <div class="col-span-4" style="float:left; margin-top:20px; position:relative; z-index:100;">
          <span class="definition" style="font-weight:bold; display:inline;">{% trans "Highlight" %}</span>

          <span id="highlight">
              <select id="highlight_select" onchange="highlight();" style="width: 140px"><option/></select>
          </span>

        </div>

        {% endif %}
	      </div>
        <br>
        <div id="moreOptions">
          <div id="moContainer">
            <div class="clone_loader">
              <span class="definition" style="font-weight:bold; margin-left:20px;">Display Mode:</span>
              <div class="btn-group flow-net-gross disabled" data-toggle="buttons" style="margin-top:0px; margin-left:20px">
                <label class="btn btn-default btn-detail {% if trade_flow == "import" or trade_flow == "export" %} active{% endif %}">
                  <input type="radio" name="display_mode" value="nesting_0" onchange="$('.flow-net-gross').children().eq(1).removeClass('active'); $(this).parent().addClass('active');update_viz();">Dynamic
                </label>
                <label class="btn btn-default btn-detail {% if trade_flow == "net_import" or trade_flow == "net_export" %} active{% endif %}">
                  <input type="radio" name="display_mode" value="nesting_2" onchange="$('.flow-net-gross').children().eq(0).removeClass('active'); $(this).parent().addClass('active');update_viz();">Static
                </label>
              </div>

              <span class="definition" style="font-weight:bold; margin-left:20px;">Non-Significant Products:</span>
              <div class="btn-group flow-net-gross disabled" data-toggle="buttons" style="margin-top:0px; margin-left:20px">
                <label class="btn btn-default btn-detail {% if trade_flow == "import" or trade_flow == "export" %} active{% endif %}">
                  <input type="radio" name="non_products" value="nesting_0" onchange="$('.flow-net-gross').children().eq(1).removeClass('active'); $(this).parent().addClass('active');update_viz();">Show
                </label>
                <label class="btn btn-default btn-detail {% if trade_flow == "net_import" or trade_flow == "net_export" %} active{% endif %}">
                  <input type="radio" name="non_products" value="nesting_2" onchange="$('.flow-net-gross').children().eq(0).removeClass('active'); $(this).parent().addClass('active');update_viz();">Hide
                </label>
              </div>
            </div>

          </div>

        </div>
      </div>
      <footer>
      <div class="footerInner">

        <span>{% trans "The Atlas of Economic complexity is a powerful interactive tool that enables users to visualize a country's total trade, track how these dynamics change over time and explore growth opportunities for more than a hundred countries worldwide." %}</span>
        <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/InteractiveResource" property="dct:title" rel="dct:type">The Atlas of Economic complexity</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>. Current version: <a href="https://github.com/cid-harvard/atlas-economic-complexity">{{ VERSION }}</a>.
        <br />
        <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"><img alt="Creative Commons License" style="border-width:0 display:block;" src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" /></a>
        <p style="clear:both"></p>
        <a style=" margin-left:150px; float:left;" href="http://www.hks.harvard.edu/centers/cid"><img src="media/img/all/logo_cid.png" alt="Center for International Development Logo"/></a>

        <div class="language_select" style="float:right; margin-right:150px;">
          <div class="text">
            Language:
          </div>
          <select>
            {% for lang in supported_langs %}
            <option style="" value="{{lang.0.code}}" {% if lang.0.code == LANGUAGE_CODE %} selected="selected" {% endif %}>{{lang.0.name_local}}</option>
            {% endfor %}
          </select>
        </div>

      </div>

    </footer>
         <!--<p id="showMore"><i class='fa fa-caret-down'> More Options</i></p>-->
      </div>


      <!-- The right pane -->
      <div id="tool_pane" class="bootstro" data-bootstro-title="Sharing Panel" data-bootstro-content="The Sharing Panel allows you to export the current visualization through social media and email." data-toggle="tooltip" data-bootstro-placement="left">

    <div id="sharebuttons">
        <h4 class="explore-share-label" style="border-bottom: solid 1px #999; font-family:'PT Sans Narrow',Helvetica,Arial; font-size:95%; font-weight:500;">{% trans "Share" %}</h4>
        {% with current_url=request.build_absolute_uri|iriencode %}
        <a href="https://facebook.com/sharer.php?u={{current_url}}" target="_blank">
          <i class="fa fa-facebook fa-lg"></i>
        </a>

        <a href="https://twitter.com/intent/tweet?url={{current_url}}&text={{title|iriencode}}&via=atlas_facts" target="_blank">
          <i class="fa fa-twitter fa-lg"></i>
        </a>

        <a href="https://plus.google.com/share?url={{current_url}}">
          <i class="fa fa-google-plus fa-lg"></i>
        </a>

        <a href="mailto:?subject=Atlas of Economic Complexity: {{title}}&body=Take a look here: {{current_url}}">
          <i class="fa fa-envelope fa-lg"></i>
        </a>
        {% endwith %}
    </div>

    <form id="download" method="POST" action="{{HTTP_HOST}}download/">
        {% csrf_token %}
        <h4 class="explore-share-label" style="border-bottom: solid 1px #999; font-family:'PT Sans Narrow',Helvetica,Arial; font-size:95%; font-weight:500; margin: 0; padding: 0 0 2px 0; margin: 10px 0px;  text-align:center; margin-left:-5px; width:40px;">{% trans "Download" %}</h4>
        <a id="pdf" href="#">PDF</a>
        <a id="png" href="#">PNG</a>
        <a id="svg" href="#">SVG</a>
        <input type="hidden" id="file_content" name="file_content"/>
        <input type="hidden" id="file_name" name="file_name" value="{{title}}"/>
        <input type="hidden" id="file_format" name="file_format" value="svg"/>
    </form>

        <h4 class="explore-share-label" style="border-bottom: solid 1px #999; font-family:'PT Sans Narrow',Helvetica,Arial; font-size:95%; font-weight:500; position:relative;left:-2px">{% trans "Feedback" %}</h4>
        <a id="feedbackPlaceholder" href="https://docs.google.com/forms/d/1lj1okNNN4U7O6207dJwxG6i0Yp_NqH1mKFADW_rurfE/viewform?entry.1903449278&entry.1131927011&entry.49173428&entry.1847748354={{ VERSION }}" target="_blank">
          <i class="fa fa-comment fa-lg"></i>
        </a>


    </div>


      </div> <!-- END Right pane -->

    </div> <!-- END #main -->
    <div class="autocomplete-wrap"></div>

    <canvas style="display: none; overflow:hidden;" id="canvas" width="750px" height="520px"></canvas>

  </div> <!-- END #container -->
{% endif %}
  <!-- Glossary -->
  <div id="glossary" style="display:none;">
    {% include "about/glossary_text.html" %}
  </div>

  <script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
  <script src="//code.jquery.com/ui/1.10.3/jquery-ui.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/select2/3.4.8/select2.min.js" ></script>
  <script src="{{ STATIC_URL }}js/utils.js"></script>
  <script src="//www.google-analytics.com/cx/api.js?experiment=1TlRMfvcStutXnhZwghKnw"></script>

  {% compress js %}
  <script type="text/javascript" src="{{ STATIC_URL }}js/libs/helpbox.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}js/explore/dropdowns.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}js/libs/underscore/underscore-min.js"></script>

  <script type="text/javascript" src="{{ STATIC_URL}}js/explore/download.js"></script>
  <script src="{{ STATIC_URL }}js/libs/d3/d3.v3.min.js" charset="utf-8"></script>

  <script src="{{ STATIC_URL }}js/libs/bootstrap/js/bootstrap.min.js"></script>
  <script src="{{ STATIC_URL }}js/libs/bootstro/bootstro.min.js"></script>
  <script src="{{ STATIC_URL }}js/libs/typed.js"></script>

  <!-- App -->
  <script src="{{ STATIC_URL }}js/explore/general.js?{{ VERSION }}"></script>
  <script src="{{ STATIC_URL }}js/explore/key.js?{{ VERSION }}"></script>
  <script src="{{ STATIC_URL }}js/explore/timeline.js?{{ VERSION }}"></script>
  <script src="{{ STATIC_URL }}js/explore/controls.js?{{ VERSION }}"></script>
  <script src="{{ STATIC_URL }}js/apps/related.js?{{ VERSION }}"></script>
  <script src="{{ STATIC_URL }}js/libs/toastr/toastr.min.js"></script>

  <script src="{{ STATIC_URL }}js/libs/d3plus/lib/modernizr.custom.js"></script>
  <script src="{{ STATIC_URL }}js/libs/d3plus/src/general.js"></script>
  <script src="{{ STATIC_URL }}js/libs/d3plus/src/utils.js"></script>
  <script src="{{ STATIC_URL }}js/libs/d3plus/src/tooltip.js"></script>
  <script src="{{ STATIC_URL }}js/explore/viz_general.js"></script>
  <script type="text/javascript">
  // Hack to be able to get error messages out of selenium
  window.jsErrors = [];
  window.onerror = function(errorMessage) {
      window.jsErrors[window.jsErrors.length] = errorMessage;
  }
  </script>
  {% endcompress %}

  {% if app_name != "map" %}

    <script src="{{ STATIC_URL }}js/libs/vizwiz/src/utils.slider.js"></script>


    <script src="{{ STATIC_URL }}js/libs/d3plus/src/viz/viz.js"></script>

      {% if app_name == "tree_map" %}<script src="{{ STATIC_URL }}js/libs/d3plus/src/viz/tree_map.js"></script>{% endif %}
      {% if app_name == "stacked" %}<script src="{{ STATIC_URL }}js/libs/d3plus/src/viz/stacked.js"></script>{% endif %}
      {% if app_name == "pie_scatter" or app_name == "scatterplot" %}<script src="{{ STATIC_URL }}js/libs/d3plus/src/viz/pie_scatter.js"></script>{% endif %}
      {% if app_name == "product_space" %}<script src="{{ STATIC_URL }}js/libs/d3plus/src/viz/network.js"></script>{% endif %}
      {% if app_name == "map" %}<!-- <script src="media/js/libs/d3plus/src/viz/geo_map.js"></script>-->{% endif %}
      {% if app_name == "rings" %}<script src="{{ STATIC_URL }}js/libs/d3plus/src/viz/rings.js"></script>{% endif %}

    {% elif app_name == "scatterplot_new" %}

    <script src="{{ STATIC_URL }}js/libs/d3plus/d3plus.v1.2.4.js"></script>

  {% endif %}

  {% if app_name == "map" %}

    <script src="{{ STATIC_URL }}js/libs/vizwiz/lib/modernizr.custom.js"></script>
    <script src="{{ STATIC_URL }}js/libs/vizwiz/src/general.js"></script>
    <script src="{{ STATIC_URL }}js/libs/vizwiz/src/utils.js"></script>
    <script src="{{ STATIC_URL }}js/libs/vizwiz/src/tooltip.js"></script>
    <script src="{{ STATIC_URL }}js/libs/vizwiz/src/utils.slider.orig.js"></script>
    <script src="{{ STATIC_URL }}js/libs/vizwiz/src/viz/viz.js"></script>
    <script src="{{ STATIC_URL }}js/apps/map.js"></script>

  {% endif %}

  {% if app_name == "rankings" %}

    <script src="{{ STATIC_URL }}js/apps/rankings.js"></script>

  {% endif %}

  <script>


    // Ask GA for the search variation
    var search_var = cxApi.chooseVariation();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-41291966-1', 'harvard.edu');
    ga('send', 'pageview');

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-41291966-1']);
    _gaq.push(['_trackPageview']);


    $("#glossary h4").each(function(index) {
        if($("#glossary").length > 0) {
          var word = $(this).text();
          var definition = $("#glossary").find("p")[index].innerHTML;

          $(".definition").each(function () {
            // Update all instances of that word in the content page with mouse over def.
            var html = $(this).html();
            html = html.replace(new RegExp(word, 'g'), '<font class="definition trigger-link" data-container="body" data-toggle="popover" data-placement="top" data-content="'+definition+'" title="<b>'+word+'</b>">'+word+'</font>');
            $(this).html(html);
           $(this).children().popover({ html: true, trigger: "hover", delay: { show: 1000, hide: 100, title: "word"}});

          });
        }
    });

  clicked = false;
  $("#showMore").click(function(){
    if(clicked == false){
      $(this).addClass("moreActive");
      $(this).html("<i class='fa fa-caret-up'> Less Options</i> ");
      clicked = true;
    }else{
      $(this).removeClass("moreActive");
      $(this).html("<i class='fa fa-caret-down'> More Options");
      clicked = false;
    }
    $("#moreOptions").slideToggle(100);
  });


</script>

<script>


  // Set up jquery to use django CSRF token
  function getCookie(name) {
      var cookieValue = null;
      if (document.cookie && document.cookie != '') {
          var cookies = document.cookie.split(';');
          for (var i = 0; i < cookies.length; i++) {
              var cookie = jQuery.trim(cookies[i]);
              // Does this cookie string begin with the name we want?
              if (cookie.substring(0, name.length + 1) == (name + '=')) {
                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                  break;
              }
          }
      }
      return cookieValue;
  }

  function csrfSafeMethod(method) {
      // these HTTP methods do not require CSRF protection
      return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
  }
  $.ajaxSetup({
      beforeSend: function(xhr, settings) {
          if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
              xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
          }
      }
  });

  // variables from server
  var app,
    app_types = ["tree_map", "stacked", "product_space", "rings", "pie_scatter", "map"],
    app_type ="{{app_type}}",
    warning = "{{warning}}",
    is_alert = "{{alert}}",
    api_uri = "{{api_uri}}",
    year =  "{{year}}",
    app_name = "{{app_name}}",
    years_available = {{years_available|safe}},
    trade_flow = "{{trade_flow}}",
    country1 = "{{country1}}",
    country2 = "{{country2}}",
    country1_3char = "{{country1_3char}}",
    country2_3char = "{{country2_3char}}",
    product = "{{product}}",
    item_type = "{{item_type}}",
    prod_or_partner = "{{prod_or_partner}}",
    lang= "{{lang}}",
    embed=false,
		d = "{{redesign_api_uri}}",
    year_start = "{{year_start}}",
    year_end = "{{year_end}}",
    product_code = "{{product_code}}",
    prod_class = "{{prod_class}}",
    previous_page = "{{previous_page}}",
    previous_image = "{{previous_image}}",
    static_url = "{{STATIC_URL}}",
    in_iframe = is_in_iframe(),
    static_image = "{{static_image}}";

  // language select dropdown
  $(".language_select select").on("change", function(){
    // set session data to new language
    var language = $(this).val();
    window.location = "/set_language/"+language+"/";
  });

  </script>

  <script src="media/js/highlight.js"></script>
  <script src="media/js/queryparameters.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL}}js/searchresults.js"></script>
  <!-- Adding the javascript i18l file from django -->
  <script type="text/javascript" src="{% url 'django.views.i18n.javascript_catalog' %}"></script>
  

  <script>

  if(queryActivated) {
    updateURLQueryParameters();

    //$("input[name='level_detail']").prop("selected", false);
    //$(".btn-detail").prop("selected", false);
    //$("input[name='level_detail'][value='nesting_0']").prop("selected", true);


    // Dynamically update the interface based on queryParameters values
    if(app_name=="tree_map") {
      d3.selectAll("input[name='level_detail']").property("checked", false)
      d3.selectAll("input[value='nesting_"+queryParameters['details_treemap']+"']").property("checked", true)
    }

    if(app_name=="pie_scatter") {
      if(queryParameters["yaxis"] == "opp_gain") {
        d3.select("#yaxis-opp_gain").classed("active", true)
        d3.select("#yaxis-complexity").classed("active", false)
      }
    }

   if(app_name=="stacked" && item_type == "products") {
      d3.selectAll('.capita').classed("active", false);
      if(queryParameters["yaxis"] == "pc_constant")
        d3.select(d3.select("#pc_constant").node().parentNode).classed("active", true)
      else if(queryParameters["yaxis"] == "notpc_constant")
        d3.select(d3.select("#notpc_constant").node().parentNode).classed("active", true)      
      else if(queryParameters["yaxis"] == "pc_current")
        d3.select(d3.select("#pc_current").node().parentNode).classed("active", true) 
      else
        d3.select(d3.select("#current").node().parentNode).classed("active", true)   
    }


  }

  // set active link in top nav for current page
  var current_page = "explore";
  $("nav ul a").each(function(i, el){
    if($(el).text().toLowerCase() == current_page){
      $(el).addClass("current");
    }
  })


  // Page init scripts
  $(function () {

    if(queryParameters['disable_widgets']) {

      var opacity_level = .2;

      d3.select("#app_pane").style("opacity", opacity_level);
      d3.select("#myTab").style("opacity", opacity_level);
      d3.select("#tool_pane").style("opacity", opacity_level);
      d3.select(".contentInner").style("opacity", opacity_level);
      d3.select(".footerInner").style("opacity", opacity_level);      

    }

    $("#help").click(function(){
        bootstro.start(".bootstro",{
          finishButtonText: "Done"
        });
      });

    // Be sure we came back to the top of the page
    $(this).scrollTop(0);

  $('#myTab a').click(function (e) {
    e.preventDefault()
    $(this).tab('show')
  })


  $("#tfViz label").click(function(){
    return update_viz($(this).attr("value"));
  });

  {% if display_iframe %}
  //To display visualization in full screen, while viewing stories
  var contentWidth = window.innerWidth;
  var contentHeight = window.innerHeight;

  {% else %}

  //To display visualization in full screen, while viewing stories
  var contentWidth=$("#content").width();
  var contentHeight = 520;

  {% endif %}

  // Call the original and let is handle the stuff - trying again

  if(static_image != "only")
    build_viz_app_original(api_uri, contentWidth, contentHeight);


});


  </script>


<!-- Activates tooltips /////////////////////////////////////////////////////////////////// -->

<script type="text/javascript" src="../media/js/libs/tipsy/tipsy.jquery.js"></script>


  <script type="text/javascript">


    if(previous_image == "/media/img/all/loader.gif"){
      $("#historyTab").css("display", "none");
      $("#history").css("display", "none");
    } else{
      previous_image = "/static_image/{{ previous_image }}";
      $("#historySlide").attr("href", previous_page);
    }

    $("#historySlide, #historyOverlay").css("background-image", "url("+previous_image+")");

    $("#historySlide").mouseenter(function(){
      $("#historyOverlay").show();
    });

    $("#historySlide").mouseleave(function(){
      $("#historyOverlay").hide();
    });
    if( /iPhone/i.test(navigator.userAgent) ) {
      $("head").append('<meta name="viewport" content="width=648, initial-scale=0.3" />')
    }
    if( /iPad/i.test(navigator.userAgent) ) {
      $("head").append('<meta name="viewport" content="width=648, initial-scale=0.7" />')
    }

    function refresh_overlay(){
      $("#refreshOverlay").show();
    }

    function remove_overlay(){
      $("#refreshOverlay").hide();
    }

    $("select").change(function(){
      if($(this).attr("id") != "highlight_select"){
        refresh_overlay();
      }
    });
    $(".nav-tabs li a").click(function(){
      var parent = $(this).parent();
      if(parent.parent().attr("id") != "utilityBox"){
        if($(this).parent().attr("class") != "active"){
          refresh_overlay();
        } else{
          remove_overlay();
        }
      }
    });

  $(function() {
    $('button[title]').tipsy({gravity: 'w', delayIn: 500});
    $('label[title]').tipsy({gravity: 'n', delayIn: 500});

    /*
    if(!($.cookie("popup") == "true") && (previous_page == "None" || previous_page == "http://127.0.0.1:8000/" || previous_page == "http://atlas.cid.harvard.edu/")) {
      setTimeout(function() {
        bootstro.start("#text_title",{finishButtonText: "Got it!"});
       $.cookie("popup", "true");
     }, 2000);
    
    }
  */
  });
  </script>
</body>
</html>
